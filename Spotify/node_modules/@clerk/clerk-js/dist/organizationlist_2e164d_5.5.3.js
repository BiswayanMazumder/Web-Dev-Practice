"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([[653],{1987:function(e,t,i){i.r(t),i.d(t,{OrganizationList:function(){return W}});var n=i(2903),a=i(3918),o=i(3476),r=i(3736),s=i(6131),l=i(2784),c=i(8512),d=i(1661),u=i(7790),g=i(3647),p=i(9820);const h=e=>(0,n.tZ)(o.Col,{elementDescriptor:o.descriptors.organizationListPreviewItems,sx:e=>({maxHeight:`calc(8 * ${e.sizes.$12})`,overflowY:"auto",borderTopWidth:e.borderWidths.$normal,borderTopStyle:e.borderStyles.$solid,borderTopColor:e.colors.$neutralAlpha100,...p.common.unstyledScrollbar(e)}),children:e.children}),v=e=>({padding:`${e.space.$4} ${e.space.$5}`}),z=e=>({color:e.colors.$colorText,":hover":{color:e.colors.$colorText}}),m=e=>(0,n.BX)(o.Flex,{align:"center",gap:2,sx:[e=>({minHeight:"unset",justifyContent:"space-between",borderTopWidth:e.borderWidths.$normal,borderTopStyle:e.borderStyles.$solid,borderTopColor:e.colors.$neutralAlpha100}),v],elementDescriptor:o.descriptors.organizationListPreviewItem,children:[(0,n.tZ)(c.OrganizationPreview,{elementId:"organizationList",mainIdentifierSx:z,organization:e.organizationData}),e.children]}),C=(0,l.forwardRef)(((e,t)=>(0,n.tZ)(o.Box,{ref:t,sx:e=>({width:"100%",height:e.space.$12,position:"relative"}),children:(0,n.tZ)(o.Box,{sx:{margin:"auto",position:"absolute",left:"50%",top:"50%",transform:"translateY(-50%) translateX(-50%)"},children:(0,n.tZ)(o.Spinner,{size:"sm",colorScheme:"primary",elementDescriptor:o.descriptors.spinner})})}))),S=e=>(0,n.tZ)(o.Button,{elementDescriptor:o.descriptors.organizationListPreviewItemActionButton,textVariant:"buttonSmall",variant:"outline",size:"xs",...e}),$=e=>(0,n.tZ)(c.PreviewButton,{elementDescriptor:o.descriptors.organizationListPreviewButton,sx:[v],icon:u.nR,...e});var Z=i(2400),x=i(1659),b=i(9120);const L=(0,c.withCardStateProvider)((e=>{const t=(0,c.useCardState)(),{navigateAfterSelectOrganization:i}=(0,a.useOrganizationListContext)(),{isLoaded:o,setActive:r}=(0,s.eW)();return o?(0,n.tZ)($,{onClick:()=>{return n=e.organization,t.runAsync((async()=>{await r({organization:n}),await i(n)}));var n},children:(0,n.tZ)(c.OrganizationPreview,{elementId:"organizationList",mainIdentifierSx:z,organization:e.organization})}):null})),w=(0,c.withCardStateProvider)((()=>{const e=(0,c.useCardState)(),{hidePersonal:t,navigateAfterSelectPersonal:i}=(0,a.useOrganizationListContext)(),{isLoaded:o,setActive:r}=(0,s.eW)(),{user:l}=(0,s.aF)();if(!l)return null;const{username:d,primaryEmailAddress:u,primaryPhoneNumber:g,...p}=l;return t?null:(0,n.tZ)($,{onClick:()=>{if(o)return e.runAsync((async()=>{await r({organization:null}),await i(l)}))},children:(0,n.tZ)(c.PersonalWorkspacePreview,{user:p,mainIdentifierSx:z,title:(0,b.u1)("organizationSwitcher.personalWorkspace")})})})),y={userMemberships:{infinite:!0},userInvitations:{infinite:!0},userSuggestions:{infinite:!0,status:["pending","accepted"]}},f=e=>{const t=(0,c.useCardState)();return(0,n.tZ)(S,{isLoading:t.isLoading,onClick:e.onAccept,localizationKey:(0,o.localizationKeys)("organizationList.action__invitationAccept")})},P=(0,c.withCardStateProvider)((e=>{const t=(0,c.useCardState)(),{getOrganization:i}=(0,s.cL)(),[a,o]=(0,l.useState)(null),{userInvitations:r}=(0,s.eW)({userInvitations:y.userInvitations,userMemberships:y.userMemberships});return a?(0,n.tZ)(L,{organization:a}):(0,n.tZ)(m,{organizationData:e.publicOrganizationData,children:(0,n.tZ)(f,{onAccept:()=>t.runAsync((async()=>[await e.accept(),await i(e.publicOrganizationData.id)])).then((([e,t])=>{var i;null===(i=null==r?void 0:r.setData)||void 0===i||i.call(r,(t=>(0,x.Sz)(e,t,"negative"))),o(t)})).catch((e=>(0,Z.S3)(e,[],t.setError)))})})})),A=e=>{const t=(0,c.useCardState)(),{userSuggestions:i}=(0,s.eW)({userSuggestions:y.userSuggestions});return"accepted"===e.status?(0,n.tZ)(o.Text,{colorScheme:"secondary",localizationKey:(0,o.localizationKeys)("organizationList.suggestionsAcceptedLabel")}):(0,n.tZ)(S,{isLoading:t.isLoading,onClick:()=>t.runAsync(e.accept).then((e=>{var t;return null===(t=null==i?void 0:i.setData)||void 0===t?void 0:t.call(i,(t=>(0,x.Sz)(e,t)))})).catch((e=>(0,Z.S3)(e,[],t.setError))),localizationKey:(0,o.localizationKeys)("organizationList.action__suggestionsAccept")})},O=(0,c.withCardStateProvider)((e=>(0,n.tZ)(m,{organizationData:e.publicOrganizationData,children:(0,n.tZ)(A,{...e})}))),k=()=>{const{userMemberships:e,userInvitations:t,userSuggestions:i}=(0,s.eW)(y),{ref:n}=(0,d.YD)({threshold:0,onChange:n=>{var a,o,r;n&&(e.hasNextPage?null===(a=e.fetchNext)||void 0===a||a.call(e):t.hasNextPage?null===(o=t.fetchNext)||void 0===o||o.call(t):null===(r=i.fetchNext)||void 0===r||r.call(i))}});return{userMemberships:e,userInvitations:t,userSuggestions:i,ref:n}},I=({onCreateOrganizationClick:e})=>{const{user:t}=(0,s.aF)();return(null==t?void 0:t.createOrganizationEnabled)?(0,n.tZ)(c.Action,{elementDescriptor:o.descriptors.organizationListCreateOrganizationActionButton,icon:u.mm,label:(0,o.localizationKeys)("organizationList.action__createOrganization"),onClick:e,sx:e=>({borderTopWidth:e.borderWidths.$normal,borderTopStyle:e.borderStyles.$solid,borderTopColor:e.colors.$neutralAlpha100,padding:`${e.space.$5} ${e.space.$5}`}),iconSx:e=>({width:e.sizes.$9,height:e.sizes.$6})}):null},D=(0,c.withCardStateProvider)((()=>{const e=(0,c.useCardState)(),{userMemberships:t,userSuggestions:i,userInvitations:r}=k(),s=(null==t?void 0:t.isLoading)||(null==r?void 0:r.isLoading)||(null==i?void 0:i.isLoading),l=!!((null==t?void 0:t.count)||(null==r?void 0:r.count)||(null==i?void 0:i.count)),{hidePersonal:d}=(0,a.useOrganizationListContext)();return(0,n.BX)(c.Card.Root,{children:[(0,n.BX)(c.Card.Content,{sx:e=>({padding:`${e.space.$8} ${e.space.$none} ${e.space.$none}`}),children:[(0,n.tZ)(c.Card.Alert,{sx:e=>({margin:`${e.space.$none} ${e.space.$5}`}),children:e.error}),s&&(0,n.tZ)(o.Flex,{direction:"row",align:"center",justify:"center",sx:e=>({height:"100%",minHeight:e.sizes.$60}),children:(0,n.tZ)(o.Spinner,{size:"lg",colorScheme:"primary",elementDescriptor:o.descriptors.spinner})}),!s&&(0,n.tZ)(T,{showListInitially:!(d&&!l)})]}),(0,n.tZ)(c.Card.Footer,{})]})})),T=({showListInitially:e})=>{const{navigateAfterCreateOrganization:t,skipInvitationScreen:i}=(0,a.useOrganizationListContext)(),[r,s]=(0,l.useState)(!e);return(0,n.BX)(n.HY,{children:[!r&&(0,n.tZ)(B,{onCreateOrganizationClick:()=>s(!0)}),r&&(0,n.tZ)(o.Box,{sx:e=>({padding:`${e.space.$none} ${e.space.$5} ${e.space.$5}`}),children:(0,n.tZ)(g.$,{flow:"organizationList",startPage:{headerTitle:(0,o.localizationKeys)("organizationList.createOrganization")},skipInvitationScreen:i,navigateAfterCreateOrganization:e=>t(e).then((()=>s(!1))),onCancel:e&&r?()=>s(!1):void 0})})]})},B=e=>{var t,i,r;const s=(0,a.useEnvironment)(),{ref:l,userMemberships:d,userSuggestions:u,userInvitations:g}=k(),{hidePersonal:p}=(0,a.useOrganizationListContext)(),v=(null==d?void 0:d.isLoading)||(null==g?void 0:g.isLoading)||(null==u?void 0:u.isLoading),z=(null==d?void 0:d.hasNextPage)||(null==g?void 0:g.hasNextPage)||(null==u?void 0:u.hasNextPage),m=null===(t=g.data)||void 0===t?void 0:t.filter((e=>!!e)),S=null===(i=u.data)||void 0===i?void 0:i.filter((e=>!!e));return(0,n.BX)(n.HY,{children:[(0,n.BX)(c.Header.Root,{sx:e=>({padding:`${e.space.$none} ${e.space.$8}`}),children:[(0,n.tZ)(c.Header.Title,{localizationKey:(0,o.localizationKeys)(p?"organizationList.titleWithoutPersonal":"organizationList.title")}),(0,n.tZ)(c.Header.Subtitle,{localizationKey:(0,o.localizationKeys)("organizationList.subtitle",{applicationName:s.displayConfig.applicationName})})]}),(0,n.tZ)(o.Col,{elementDescriptor:o.descriptors.main,children:(0,n.tZ)(h,{children:(0,n.BX)(c.Actions,{role:"menu",children:[(0,n.tZ)(w,{}),(d.count||0)>0&&(null===(r=d.data)||void 0===r?void 0:r.map((e=>(0,n.tZ)(L,{...e},e.id)))),!d.hasNextPage&&(null==m?void 0:m.map((e=>(0,n.tZ)(P,{...e},e.id)))),!d.hasNextPage&&!g.hasNextPage&&(null==S?void 0:S.map((e=>(0,n.tZ)(O,{...e},e.id)))),(z||v)&&(0,n.tZ)(C,{ref:l}),(0,n.tZ)(I,{onCreateOrganizationClick:()=>{e.onCreateOrganizationClick()}})]})})})]})},N=(0,a.withCoreUserGuard)(D),W=()=>(0,n.tZ)(o.Flow.Root,{flow:"organizationList",children:(0,n.tZ)(o.Flow.Part,{children:(0,n.tZ)(r.Switch,{children:(0,n.tZ)(r.Route,{children:(0,n.tZ)(N,{})})})})})}}]);