"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([[971],{906:function(e,t,o){o.r(t),o.d(t,{UserProfile:function(){return nt},UserProfileModal:function(){return at}});var i=o(2903),r=o(2784),n=o(3918),a=o(3476),s=o(8512),l=o(3736),c=o(9120);const d=e=>{const{pages:t}=(0,n.useUserProfileContext)();return(0,i.BX)(s.NavbarContextProvider,{children:[(0,i.tZ)(s.NavBar,{title:(0,c.u1)("userProfile.navbar.title"),description:(0,c.u1)("userProfile.navbar.description"),routes:t.routes,contentRef:e.contentRef}),e.children]})};var u=o(3185),m=o(8246),p=o(6131),h=o(2045),f=o(5235),v=o(1671),P=o(1661),g=o(2400);const y=()=>{const e=(0,s.useCardState)(),{user:t}=(0,p.aF)(),{navigate:o}=(0,l.useRouter)(),{strategies:r,strategyToDisplayData:c}=(0,P.vO)(),{additionalOAuthScopes:d,componentName:u,mode:m}=(0,n.useUserProfileContext)(),f="modal"===m,v=r.filter((e=>e.startsWith("oauth"))),y=null==t?void 0:t.verifiedExternalAccounts.map((e=>`oauth_${e.provider}`)),Z=v.filter((e=>!y.includes(e)));return 0===Z.length?null:(0,i.tZ)(s.ProfileSection.ActionMenu,{triggerLocalizationKey:(0,a.localizationKeys)("userProfile.start.connectedAccountsSection.primaryButton"),id:"connectedAccounts",children:Z.map((r=>(0,i.tZ)(s.ProfileSection.ActionMenuItem,{id:c[r].id,onClick:()=>(i=>{const r=i.replace("oauth_",""),n=f?(0,h.bX)({url:window.location.href,componentName:u,socialProvider:r}):window.location.href,a=d?d[r]:[];e.setLoading(i),null==t||t.createExternalAccount({strategy:i,redirectUrl:n,additionalScopes:a}).then((t=>{var r;(null===(r=t.verification)||void 0===r?void 0:r.externalVerificationRedirectURL)&&((0,g._v)(2e3).then((()=>e.setIdle(i))),o(t.verification.externalVerificationRedirectURL.href))})).catch((t=>{(0,g.S3)(t,[],e.setError),e.setIdle(i)}))})(r),isDisabled:e.isLoading,variant:"ghost",isLoading:e.loadingMetadata===r,focusRing:!1,closeAfterClick:!1,localizationKey:(0,a.localizationKeys)("userProfile.connectedAccountPage.socialButtonsBlockButton",{provider:c[r].name}),sx:e=>({justifyContent:"start",gap:e.space.$2}),leftIcon:(0,i.tZ)(a.Image,{isLoading:e.loadingMetadata===r,isDisabled:e.isLoading,elementDescriptor:a.descriptors.providerIcon,elementId:a.descriptors.providerIcon.setId(c[r].id),src:c[r].iconUrl,alt:`Connect ${c[r].name} account`,sx:e=>({width:e.sizes.$4})})},r)))})};var Z=o(1940);const S=e=>{var t;const{onSuccess:o,onReset:n}=e,{user:s}=(0,p.aF)(),{emailId:l}=e,c=null==s?void 0:s.emailAddresses.find((e=>e.id===l)),d=r.useRef(null==c?void 0:c.emailAddress),u="verified"===(null===(t=null==c?void 0:c.verification)||void 0===t?void 0:t.status)?(0,a.localizationKeys)("userProfile.emailAddressPage.removeResource.messageLine2"):void 0;return d.current?(0,i.tZ)(Z.LE,{title:(0,a.localizationKeys)("userProfile.emailAddressPage.removeResource.title"),messageLine1:(0,a.localizationKeys)("userProfile.emailAddressPage.removeResource.messageLine1",{identifier:d.current}),messageLine2:u,successMessage:(0,a.localizationKeys)("userProfile.emailAddressPage.removeResource.successMessage",{emailAddress:d.current}),deleteResource:()=>Promise.resolve(null==c?void 0:c.destroy()),onSuccess:o,onReset:n}):null},b=e=>{var t;const{phoneId:o,onSuccess:n,onReset:s}=e,{user:l}=(0,p.aF)(),c=null==l?void 0:l.phoneNumbers.find((e=>e.id===o)),d=r.useRef(null==c?void 0:c.phoneNumber),u="verified"===(null===(t=null==c?void 0:c.verification)||void 0===t?void 0:t.status)?(0,a.localizationKeys)("userProfile.phoneNumberPage.removeResource.messageLine2"):void 0;return d.current?(0,i.tZ)(Z.LE,{title:(0,a.localizationKeys)("userProfile.phoneNumberPage.removeResource.title"),messageLine1:(0,a.localizationKeys)("userProfile.phoneNumberPage.removeResource.messageLine1",{identifier:d.current}),messageLine2:u,successMessage:(0,a.localizationKeys)("userProfile.phoneNumberPage.removeResource.successMessage",{phoneNumber:d.current}),deleteResource:()=>Promise.resolve(null==c?void 0:c.destroy()),onSuccess:n,onReset:s}):null},C=e=>{var t,o;const{accountId:n,onSuccess:s,onReset:l}=e,{user:c}=(0,p.aF)(),d=null==c?void 0:c.externalAccounts.find((e=>e.id===n)),u=r.useRef(null==d?void 0:d.provider),{providerToDisplayData:m}=(0,P.vO)();return u.current?(0,i.tZ)(Z.LE,{title:(0,a.localizationKeys)("userProfile.connectedAccountPage.removeResource.title"),messageLine1:(0,a.localizationKeys)("userProfile.connectedAccountPage.removeResource.messageLine1",{identifier:null===(t=m[u.current])||void 0===t?void 0:t.name}),messageLine2:(0,a.localizationKeys)("userProfile.connectedAccountPage.removeResource.messageLine2"),successMessage:(0,a.localizationKeys)("userProfile.connectedAccountPage.removeResource.successMessage",{connectedAccount:null===(o=m[u.current])||void 0===o?void 0:o.name}),deleteResource:()=>Promise.resolve(null==d?void 0:d.destroy()),onSuccess:s,onReset:l}):null},z=e=>{var t;const{user:o}=(0,p.aF)(),{walletId:n,onSuccess:s,onReset:l}=e,c=null==o?void 0:o.web3Wallets.find((e=>e.id===n)),d=r.useRef(null==c?void 0:c.web3Wallet),u="verified"===(null===(t=null==c?void 0:c.verification)||void 0===t?void 0:t.status)?(0,a.localizationKeys)("userProfile.web3WalletPage.removeResource.messageLine2"):void 0;return d.current?(0,i.tZ)(Z.LE,{title:(0,a.localizationKeys)("userProfile.web3WalletPage.removeResource.title"),messageLine1:(0,a.localizationKeys)("userProfile.web3WalletPage.removeResource.messageLine1",{identifier:d.current}),messageLine2:u,successMessage:(0,a.localizationKeys)("userProfile.web3WalletPage.removeResource.successMessage",{web3Wallet:d.current}),deleteResource:()=>Promise.resolve(null==c?void 0:c.destroy()),onSuccess:s,onReset:l}):null},R=e=>{const{user:t}=(0,p.aF)(),{phoneId:o,onSuccess:n,onReset:s}=e,l=null==t?void 0:t.phoneNumbers.find((e=>e.id===o)),c=r.useRef(null==l?void 0:l.phoneNumber);return c.current?(0,i.tZ)(Z.LE,{title:(0,a.localizationKeys)("userProfile.mfaPhoneCodePage.removeResource.title"),messageLine1:(0,a.localizationKeys)("userProfile.mfaPhoneCodePage.removeResource.messageLine1",{identifier:c.current}),messageLine2:(0,a.localizationKeys)("userProfile.mfaPhoneCodePage.removeResource.messageLine2"),successMessage:(0,a.localizationKeys)("userProfile.mfaPhoneCodePage.removeResource.successMessage",{mfaPhoneCode:c.current}),deleteResource:()=>Promise.resolve(null==l?void 0:l.setReservedForSecondFactor({reserved:!1})),onSuccess:n,onReset:s}):null},K=e=>{const{onSuccess:t,onReset:o}=e,{user:r}=(0,p.aF)();return r?(0,i.tZ)(Z.LE,{title:(0,a.localizationKeys)("userProfile.mfaTOTPPage.removeResource.title"),messageLine1:(0,a.localizationKeys)("userProfile.mfaTOTPPage.removeResource.messageLine1"),messageLine2:(0,a.localizationKeys)("userProfile.mfaTOTPPage.removeResource.messageLine2"),successMessage:(0,a.localizationKeys)("userProfile.mfaTOTPPage.removeResource.successMessage"),deleteResource:r.disableTOTP,onSuccess:t,onReset:o}):null},B=e=>{const{onSuccess:t,onReset:o,passkey:r}=e;return(0,i.tZ)(Z.LE,{title:(0,a.localizationKeys)("userProfile.passkeyScreen.removeResource.title"),messageLine1:(0,a.localizationKeys)("userProfile.passkeyScreen.removeResource.messageLine1",{name:r.name}),deleteResource:r.delete,onSuccess:t,onReset:o})},x=e=>{const{close:t}=(0,v.XC)();return(0,i.tZ)(C,{onSuccess:t,onReset:t,...e})},w=(0,s.withCardStateProvider)((()=>{const{user:e}=(0,p.aF)(),t=(0,s.useCardState)(),{providerToDisplayData:o}=(0,P.vO)(),{additionalOAuthScopes:r}=(0,n.useUserProfileContext)();if(!e)return null;const l=[...e.verifiedExternalAccounts,...e.unverifiedExternalAccounts.filter((e=>{var t;return null===(t=e.verification)||void 0===t?void 0:t.error}))];return(0,i.BX)(s.ProfileSection.Root,{title:(0,a.localizationKeys)("userProfile.start.connectedAccountsSection.title"),centered:!1,id:"connectedAccounts",children:[(0,i.tZ)(s.Card.Alert,{children:t.error}),(0,i.BX)(f.a.Root,{children:[(0,i.tZ)(s.ProfileSection.ItemList,{id:"connectedAccounts",children:l.map((e=>{var t,n;const l=e.username||e.emailAddress,c=null===(n=null===(t=e.verification)||void 0===t?void 0:t.error)||void 0===n?void 0:n.longMessage,d=F(e,r).length>0&&""!=e.approvedScopes,u=d?(0,a.localizationKeys)("userProfile.start.connectedAccountsSection.subtitle__reauthorize"):c;return(0,i.BX)(f.a.Root,{children:[(0,i.BX)(s.ProfileSection.Item,{id:"connectedAccounts",children:[(0,i.BX)(a.Flex,{sx:e=>({overflow:"hidden",gap:e.space.$2}),children:[(0,i.tZ)(a.Image,{elementDescriptor:[a.descriptors.providerIcon],elementId:a.descriptors.socialButtonsProviderIcon.setId(e.provider),alt:o[e.provider].name,src:o[e.provider].iconUrl,sx:e=>({width:e.sizes.$4,flexShrink:0})}),(0,i.tZ)(a.Box,{sx:{whiteSpace:"nowrap",overflow:"hidden"},children:(0,i.BX)(a.Flex,{gap:2,center:!0,children:[(0,i.tZ)(a.Text,{sx:e=>({color:e.colors.$colorText}),children:`${o[e.provider].name}`}),(0,i.tZ)(a.Text,{truncate:!0,as:"span",colorScheme:"secondary",children:l?`• ${l}`:""}),(c||d)&&(0,i.tZ)(a.Badge,{colorScheme:"danger",localizationKey:(0,a.localizationKeys)("badge__requiresAction")})]})})]}),(0,i.tZ)(_,{account:e})]}),(c||d)&&(0,i.tZ)(a.Text,{colorScheme:"danger",sx:e=>({padding:`${e.sizes.$none} ${e.sizes.$4} ${e.sizes.$1x5} ${e.sizes.$8x5}`}),localizationKey:u}),(0,i.tZ)(f.a.Open,{value:"remove",children:(0,i.tZ)(f.a.Card,{variant:"destructive",children:(0,i.tZ)(x,{accountId:e.id})})})]},e.id)}))}),(0,i.tZ)(y,{})]})]})})),_=({account:e})=>{var t,o;const r=(0,s.useCardState)(),{user:c}=(0,p.aF)(),{navigate:d}=(0,l.useRouter)(),{open:u}=(0,v.XC)(),m=null===(o=null===(t=e.verification)||void 0===t?void 0:t.error)||void 0===o?void 0:o.longMessage,{additionalOAuthScopes:f,componentName:P,mode:y}=(0,n.useUserProfileContext)(),Z="modal"===y,S=F(e,f),b=S.length>0&&""!=e.approvedScopes,C=b?(0,a.localizationKeys)("userProfile.start.connectedAccountsSection.actionLabel__reauthorize"):(0,a.localizationKeys)("userProfile.start.connectedAccountsSection.actionLabel__connectionFailed"),z=[m||b?{label:C,onClick:async()=>{var t;const o=Z?(0,h.bX)({url:window.location.href,componentName:P}):window.location.href;try{let i;if(b)i=await e.reauthorize({additionalScopes:S,redirectUrl:o});else{if(!c)throw Error("user is not defined");i=await c.createExternalAccount({strategy:e.verification.strategy,redirectUrl:o,additionalScopes:S})}await d((null===(t=i.verification.externalVerificationRedirectURL)||void 0===t?void 0:t.href)||"")}catch(i){(0,g.S3)(i,[],r.setError)}}}:null,{label:(0,a.localizationKeys)("userProfile.start.connectedAccountsSection.destructiveActionTitle"),isDestructive:!0,onClick:()=>u("remove")}].filter((e=>null!==e));return(0,i.tZ)(s.ThreeDotsMenu,{actions:z})};function F(e,t){if(!t)return[];const o=t[e.provider]||[],i=e.approvedScopes.split(" ");return 0===o.filter((e=>!i.includes(e))).length?[]:o}const T=e=>e.defaultSecondFactor?-1:1;function k(e){const t=[];return Object.entries(e).forEach((([,e])=>{e.used_for_second_factor&&t.push(...e.second_factors)})),t}function A(e,t){let o=k(e);return t.totpEnabled&&(o=o.filter((e=>"totp"!==e))),!t.backupCodeEnabled&&t.twoFactorEnabled||(o=o.filter((e=>"backup_code"!==e))),o}function I(e,t){if(!e)return[];const o=e.filter((e=>e.id===t)),i=e.filter((e=>e.id!==t)),r=i.filter((e=>{var t;return"verified"===(null===(t=e.verification)||void 0===t?void 0:t.status)})),n=i.filter((e=>{var t,o;return!!(null===(t=e.verification)||void 0===t?void 0:t.status)&&"verified"!==(null===(o=e.verification)||void 0===o?void 0:o.status)})),a=i.filter((e=>!e.verification.status));return r.sort(((e,t)=>e.id.localeCompare(t.id))),n.sort(((e,t)=>{var o,i;return(null===(o=e.verification)||void 0===o?void 0:o.expireAt)&&(null===(i=t.verification)||void 0===i?void 0:i.expireAt)?e.verification.expireAt.getTime()-t.verification.expireAt.getTime():0})),[...o,...r,...n,...a]}const X=e=>{const t=(0,s.useCardState)(),{nextStep:o,identification:n,identifier:l,onReset:c,prepareVerification:d}=e,u=()=>{var e;return null===(e=null==d?void 0:d())||void 0===e?void 0:e.catch((e=>(0,g.S3)(e,[],t.setError)))},m=(0,s.useFieldOTP)({onCodeEntryFinished:(e,t,o)=>{null==n||n.attemptVerification({code:e}).then((()=>t())).catch(o)},onResendCodeClicked:u,onResolve:o});return r.useEffect((()=>{u()}),[]),(0,i.BX)(i.HY,{children:[(0,i.tZ)(s.Form.OTPInput,{...m,label:(0,a.localizationKeys)("userProfile.emailAddressPage.emailCode.formTitle"),description:(0,a.localizationKeys)("userProfile.emailAddressPage.emailCode.formSubtitle",{identifier:l}),resendButton:(0,a.localizationKeys)("userProfile.emailAddressPage.emailCode.resendButton"),centerAlign:!1}),(0,i.BX)(s.FormButtonContainer,{children:[(0,i.tZ)(a.Button,{isLoading:m.isLoading,localizationKey:(0,a.localizationKeys)("formButtonPrimary__verify"),elementDescriptor:a.descriptors.formButtonPrimary,onClick:m.onFakeContinue}),(0,i.tZ)(a.Button,{variant:"ghost",isDisabled:m.isLoading,localizationKey:(0,a.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:a.descriptors.formButtonReset,onClick:c})]})]})};var L=o(6874);const D=e=>{const{email:t,nextStep:o,onReset:l}=e,c=(0,s.useCardState)(),d=(0,n.useUserProfileContext)(),{startEmailLinkFlow:u}=(0,P.E2)(t),{displayConfig:m}=(0,n.useEnvironment)();function p(){const{routing:e}=d,t="virtual"===e?m.userProfileUrl:"",i=(0,L.d)(d,t);u({redirectUrl:i}).then((()=>o())).catch((e=>(0,g.S3)(e,[],c.setError)))}return r.useEffect((()=>{p()}),[]),(0,i.BX)(i.HY,{children:[(0,i.tZ)(s.VerificationLink,{resendButton:(0,a.localizationKeys)("userProfile.emailAddressPage.emailLink.resendButton"),onResendCodeClicked:p}),(0,i.tZ)(s.FormButtonContainer,{children:(0,i.tZ)(a.Button,{variant:"ghost",localizationKey:(0,a.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:a.descriptors.formButtonReset,onClick:l})})]})},$=()=>(0,i.tZ)(Z.Ej,{title:(0,a.localizationKeys)("signUp.emailLink.verifiedSwitchTab.title"),subtitle:(0,a.localizationKeys)("signUp.emailLink.verifiedSwitchTab.subtitle"),status:"verified"}),E=(0,s.withCardStateProvider)((e=>{var t,o,l;const{emailId:c,onSuccess:d,onReset:u}=e,m=(0,s.useCardState)(),{user:h}=(0,p.aF)(),f=function(e){const{userSettings:t}=e,{email_address:o}=t.attributes;return o.enabled&&o.verifications.includes("email_link")}((0,n.useEnvironment)()),v=r.useRef(null==h?void 0:h.emailAddresses.find((e=>e.id===c))),P=(0,Z.a2)({defaultStep:v.current?1:0,onNextStep:()=>m.setError(void 0)}),y=(0,g.Yp)("emailAddress","",{type:"email",label:(0,a.localizationKeys)("formFieldLabel__emailAddress"),placeholder:(0,a.localizationKeys)("formFieldInputPlaceholder__emailAddress"),isRequired:!0}),S=y.value.length>1&&(null==h?void 0:h.username)!==y.value;return(0,i.BX)(Z.en,{...P.props,children:[(0,i.tZ)(s.FormContainer,{headerTitle:(0,a.localizationKeys)("userProfile.emailAddressPage.title"),headerSubtitle:f?(0,a.localizationKeys)("userProfile.emailAddressPage.emailLink.formHint"):(0,a.localizationKeys)("userProfile.emailAddressPage.emailCode.formHint"),children:(0,i.BX)(s.Form.Root,{onSubmit:async e=>(e.preventDefault(),null==h?void 0:h.createEmailAddress({email:y.value}).then((e=>{v.current=e,P.nextStep()})).catch((e=>(0,g.S3)(e,[y],m.setError)))),children:[(0,i.tZ)(s.Form.ControlRow,{elementId:y.id,children:(0,i.tZ)(s.Form.PlainInput,{...y.props,autoFocus:!0})}),(0,i.tZ)(s.FormButtons,{submitLabel:(0,a.localizationKeys)("userProfile.formButtonPrimary__add"),isDisabled:!S,onReset:u})]})}),(0,i.tZ)(s.FormContainer,{headerTitle:(0,a.localizationKeys)("userProfile.emailAddressPage.verifyTitle"),headerSubtitle:f?(0,a.localizationKeys)("userProfile.emailAddressPage.emailLink.formSubtitle",{identifier:null===(t=v.current)||void 0===t?void 0:t.emailAddress}):(0,a.localizationKeys)("userProfile.emailAddressPage.emailCode.formSubtitle",{identifier:null===(o=v.current)||void 0===o?void 0:o.emailAddress}),children:f?(0,i.tZ)(D,{nextStep:d,email:v.current,onReset:u}):(0,i.tZ)(X,{nextStep:d,identification:v.current,identifier:null===(l=v.current)||void 0===l?void 0:l.emailAddress,prepareVerification:()=>{var e;return null===(e=v.current)||void 0===e?void 0:e.prepareVerification({strategy:"email_code"})},onReset:u})})]})})),N=e=>{const{close:t}=(0,v.XC)();return(0,i.tZ)(S,{onSuccess:t,onReset:t,...e})},O=e=>{const{close:t}=(0,v.XC)();return(0,i.tZ)(E,{onSuccess:t,onReset:t,...e})},M=()=>{const{user:e}=(0,p.aF)();return(0,i.tZ)(s.ProfileSection.Root,{title:(0,a.localizationKeys)("userProfile.start.emailAddressesSection.title"),centered:!1,id:"emailAddresses",children:(0,i.tZ)(f.a.Root,{children:(0,i.BX)(s.ProfileSection.ItemList,{id:"emailAddresses",children:[I(null==e?void 0:e.emailAddresses,null==e?void 0:e.primaryEmailAddressId).map((t=>(0,i.BX)(f.a.Root,{children:[(0,i.BX)(s.ProfileSection.Item,{id:"emailAddresses",children:[(0,i.BX)(a.Flex,{sx:e=>({overflow:"hidden",gap:e.space.$1}),children:[(0,i.tZ)(a.Text,{sx:e=>({color:e.colors.$colorText}),truncate:!0,children:t.emailAddress}),(null==e?void 0:e.primaryEmailAddressId)===t.id&&(0,i.tZ)(a.Badge,{localizationKey:(0,a.localizationKeys)("badge__primary")}),"verified"!==t.verification.status&&(0,i.tZ)(a.Badge,{localizationKey:(0,a.localizationKeys)("badge__unverified")})]}),(0,i.tZ)(U,{email:t})]}),(0,i.tZ)(f.a.Open,{value:"remove",children:(0,i.tZ)(f.a.Card,{variant:"destructive",children:(0,i.tZ)(N,{emailId:t.id})})}),(0,i.tZ)(f.a.Open,{value:"verify",children:(0,i.tZ)(f.a.Card,{children:(0,i.tZ)(O,{emailId:t.id})})})]},t.emailAddress))),(0,i.tZ)(f.a.Trigger,{value:"add",children:(0,i.tZ)(s.ProfileSection.ArrowButton,{id:"emailAddresses",localizationKey:(0,a.localizationKeys)("userProfile.start.emailAddressesSection.primaryButton")})}),(0,i.tZ)(f.a.Open,{value:"add",children:(0,i.tZ)(f.a.Card,{children:(0,i.tZ)(O,{})})})]})})})},U=({email:e})=>{const t=(0,s.useCardState)(),{user:o}=(0,p.aF)(),{open:r}=(0,v.XC)(),n=(null==o?void 0:o.primaryEmailAddressId)===e.id,l="verified"===e.verification.status,c=[n&&!l?{label:(0,a.localizationKeys)("userProfile.start.emailAddressesSection.detailsAction__primary"),onClick:()=>r("verify")}:null,!n&&l?{label:(0,a.localizationKeys)("userProfile.start.emailAddressesSection.detailsAction__nonPrimary"),onClick:()=>null==o?void 0:o.update({primaryEmailAddressId:e.id}).catch((e=>(0,g.S3)(e,[],t.setError)))}:null,n||l?null:{label:(0,a.localizationKeys)("userProfile.start.emailAddressesSection.detailsAction__unverified"),onClick:()=>r("verify")},{label:(0,a.localizationKeys)("userProfile.start.emailAddressesSection.destructiveAction"),isDestructive:!0,onClick:()=>r("remove")}].filter((e=>null!==e));return(0,i.tZ)(s.ThreeDotsMenu,{actions:c})},q=()=>{const{user:e}=(0,p.aF)(),{getSamlProviderLogoUrl:t,getSamlProviderName:o}=(0,P.n$)();return(0,i.tZ)(s.ProfileSection.Root,{title:(0,a.localizationKeys)("userProfile.start.enterpriseAccountsSection.title"),id:"enterpriseAccounts",centered:!1,children:(0,i.tZ)(s.ProfileSection.ItemList,{id:"enterpriseAccounts",children:null==e?void 0:e.samlAccounts.map((e=>{var r,n;const l=e.emailAddress,c=o(e.provider),d=t(e.provider),u=null===(n=null===(r=e.verification)||void 0===r?void 0:r.error)||void 0===n?void 0:n.longMessage;return(0,i.BX)(s.ProfileSection.Item,{id:"enterpriseAccounts",sx:e=>({gap:e.space.$2,justifyContent:"start"}),children:[(0,i.tZ)(a.Image,{elementDescriptor:[a.descriptors.providerIcon],elementId:a.descriptors.enterpriseButtonsProviderIcon.setId(e.provider),alt:c,src:d,sx:e=>({width:e.sizes.$4})}),(0,i.tZ)(a.Box,{sx:{whiteSpace:"nowrap",overflow:"hidden"},children:(0,i.BX)(a.Flex,{gap:2,center:!0,children:[(0,i.tZ)(a.Text,{truncate:!0,colorScheme:"body",children:c}),(0,i.tZ)(a.Text,{truncate:!0,as:"span",colorScheme:"secondary",children:l?`• ${l}`:""}),u&&(0,i.tZ)(a.Badge,{colorScheme:"danger",localizationKey:(0,a.localizationKeys)("badge__requiresAction")})]})})]},e.id)}))})})},W=(0,s.withCardStateProvider)((e=>{const{phoneId:t,onSuccess:o,onReset:n}=e,{user:s}=(0,p.aF)(),l=r.useRef(null==s?void 0:s.phoneNumbers.find((e=>e.id===t))),c=(0,Z.a2)({defaultStep:l.current?1:0});return(0,i.BX)(Z.en,{...c.props,children:[(0,i.tZ)(Y,{resourceRef:l,title:(0,a.localizationKeys)("userProfile.phoneNumberPage.title"),onSuccess:c.nextStep,onReset:n}),(0,i.tZ)(V,{resourceRef:l,title:(0,a.localizationKeys)("userProfile.phoneNumberPage.verifyTitle"),onSuccess:o,onReset:n})]})})),Y=e=>{var t;const{title:o,onSuccess:r,onReset:n,onUseExistingNumberClick:l,resourceRef:c}=e,d=(0,s.useCardState)(),{user:u}=(0,p.aF)(),m=(0,g.Yp)("phoneNumber","",{type:"tel",label:(0,a.localizationKeys)("formFieldLabel__phoneNumber"),isRequired:!0}),h=m.value.length>1&&(null==u?void 0:u.username)!==m.value,f=!!(null===(t=null==u?void 0:u.phoneNumbers)||void 0===t?void 0:t.length)&&l;return(0,i.tZ)(s.FormContainer,{headerTitle:o,gap:1,children:(0,i.BX)(s.Form.Root,{gap:4,onSubmit:async e=>(e.preventDefault(),null==u?void 0:u.createPhoneNumber({phoneNumber:m.value}).then((e=>{c.current=e,r()})).catch((e=>(0,g.S3)(e,[m],d.setError)))),children:[(0,i.tZ)(a.Text,{localizationKey:(0,a.localizationKeys)("userProfile.phoneNumberPage.infoText"),colorScheme:"secondary"}),(0,i.tZ)(s.Form.ControlRow,{elementId:m.id,children:(0,i.tZ)(s.Form.PhoneInput,{...m.props,autoFocus:!0})}),(0,i.BX)(a.Flex,{justify:f?"between":"end",children:[f&&(0,i.tZ)(a.Button,{variant:"ghost",localizationKey:(0,a.localizationKeys)("userProfile.mfaPhoneCodePage.backButton"),onClick:l}),(0,i.tZ)(s.FormButtons,{submitLabel:(0,a.localizationKeys)("userProfile.formButtonPrimary__add"),isDisabled:!h,onReset:n})]})]})})},V=e=>{var t,o,r;const{title:n,onSuccess:l,resourceRef:c,onReset:d}=e;return(0,i.tZ)(s.FormContainer,{headerTitle:n,headerSubtitle:(0,a.localizationKeys)("userProfile.phoneNumberPage.verifySubtitle",{identifier:null===(t=c.current)||void 0===t?void 0:t.phoneNumber}),children:(0,i.tZ)(X,{nextStep:l,identification:c.current,identifier:null===(o=c.current)||void 0===o?void 0:o.phoneNumber,prepareVerification:null===(r=c.current)||void 0===r?void 0:r.prepareVerification,onReset:d})})},j=e=>{const{close:t}=(0,v.XC)();return(0,i.tZ)(b,{onSuccess:t,onReset:t,...e})},H=e=>{const{close:t}=(0,v.XC)();return(0,i.tZ)(W,{onSuccess:t,onReset:t,...e})},Q=()=>{const{user:e}=(0,p.aF)();return(0,i.tZ)(s.ProfileSection.Root,{centered:!1,title:(0,a.localizationKeys)("userProfile.start.phoneNumbersSection.title"),id:"phoneNumbers",children:(0,i.tZ)(f.a.Root,{children:(0,i.BX)(s.ProfileSection.ItemList,{id:"phoneNumbers",children:[I(null==e?void 0:e.phoneNumbers,null==e?void 0:e.primaryPhoneNumberId).map((t=>(0,i.BX)(f.a.Root,{children:[(0,i.tZ)(f.a.Closed,{value:"",children:(0,i.BX)(s.ProfileSection.Item,{id:"phoneNumbers",children:[(0,i.tZ)(a.Box,{sx:{whiteSpace:"nowrap",overflow:"hidden"},children:(0,i.BX)(a.Flex,{gap:2,center:!0,children:[(0,i.tZ)(a.Text,{sx:e=>({color:e.colors.$colorText}),children:(0,g.L_)(t.phoneNumber)}),(null==e?void 0:e.primaryPhoneNumberId)===t.id&&(0,i.tZ)(a.Badge,{localizationKey:(0,a.localizationKeys)("badge__primary")}),"verified"!==t.verification.status&&(0,i.tZ)(a.Badge,{localizationKey:(0,a.localizationKeys)("badge__unverified")})]})}),(0,i.tZ)(G,{phone:t})]})}),(0,i.tZ)(f.a.Open,{value:"remove",children:(0,i.tZ)(f.a.Card,{variant:"destructive",children:(0,i.tZ)(j,{phoneId:t.id})})}),(0,i.tZ)(f.a.Open,{value:"verify",children:(0,i.tZ)(f.a.Card,{children:(0,i.tZ)(H,{phoneId:t.id})})})]},t.id))),(0,i.tZ)(f.a.Trigger,{value:"add",children:(0,i.tZ)(s.ProfileSection.ArrowButton,{id:"phoneNumbers",localizationKey:(0,a.localizationKeys)("userProfile.start.phoneNumbersSection.primaryButton")})}),(0,i.tZ)(f.a.Open,{value:"add",children:(0,i.tZ)(f.a.Card,{children:(0,i.tZ)(H,{})})})]})})})},G=({phone:e})=>{const t=(0,s.useCardState)(),{open:o}=(0,v.XC)(),{user:r}=(0,p.aF)();if(!r)return null;const n=r.primaryPhoneNumberId===e.id,l="verified"===e.verification.status,c=[n&&!l?{label:(0,a.localizationKeys)("userProfile.start.phoneNumbersSection.detailsAction__primary"),onClick:()=>o("verify")}:null,!n&&l?{label:(0,a.localizationKeys)("userProfile.start.phoneNumbersSection.detailsAction__nonPrimary"),onClick:()=>r.update({primaryPhoneNumberId:e.id}).catch((e=>(0,g.S3)(e,[],t.setError)))}:null,n||l?null:{label:(0,a.localizationKeys)("userProfile.start.phoneNumbersSection.detailsAction__unverified"),onClick:()=>o("verify")},{label:(0,a.localizationKeys)("userProfile.start.phoneNumbersSection.destructiveAction"),isDestructive:!0,onClick:()=>o("remove")}].filter((e=>null!==e));return(0,i.tZ)(s.ThreeDotsMenu,{actions:c})};var J=o(9820);const ee=(0,s.withCardStateProvider)((e=>{const{onSuccess:t,onReset:o}=e,{user:r}=(0,p.aF)();if(!r)return null;const{userSettings:l}=(0,n.useEnvironment)(),c=(0,s.useCardState)(),d=(0,g.Yp)("username",r.username||"",{type:"text",label:(0,a.localizationKeys)("formFieldLabel__username"),placeholder:(0,a.localizationKeys)("formFieldInputPlaceholder__username")}),u=l.attributes.username.required,m=(!u||d.value.length>1)&&r.username!==d.value;return(0,i.tZ)(s.FormContainer,{headerTitle:r.username?(0,a.localizationKeys)("userProfile.usernamePage.title__update"):(0,a.localizationKeys)("userProfile.usernamePage.title__set"),children:(0,i.BX)(s.Form.Root,{onSubmit:async()=>{try{await r.update({username:d.value}),t()}catch(e){(0,g.S3)(e,[d],c.setError)}},children:[(0,i.tZ)(s.Form.ControlRow,{elementId:d.id,children:(0,i.tZ)(s.Form.PlainInput,{...d.props,autoFocus:!0,isRequired:u})}),(0,i.tZ)(s.FormButtons,{isDisabled:!m,onReset:o})]})})})),te=()=>{const{close:e}=(0,v.XC)();return(0,i.tZ)(ee,{onSuccess:e,onReset:e})},oe=()=>{const{user:e}=(0,p.aF)();return e?(0,i.tZ)(s.ProfileSection.Root,{title:(0,a.localizationKeys)("userProfile.start.usernameSection.title"),id:"username",sx:{alignItems:"center",[J.mqu.md]:{alignItems:"flex-start"}},children:(0,i.BX)(f.a.Root,{children:[(0,i.tZ)(f.a.Closed,{value:"edit",children:(0,i.BX)(s.ProfileSection.Item,{id:"username",sx:{paddingLeft:e.username?void 0:"0"},children:[e.username&&(0,i.tZ)(a.Text,{truncate:!0,sx:e=>({color:e.colors.$colorText}),children:e.username}),(0,i.tZ)(f.a.Trigger,{value:"edit",children:(0,i.tZ)(s.ProfileSection.Button,{id:"username",localizationKey:e.username?(0,a.localizationKeys)("userProfile.start.usernameSection.primaryButton__updateUsername"):(0,a.localizationKeys)("userProfile.start.usernameSection.primaryButton__setUsername")})})]})}),(0,i.tZ)(f.a.Open,{value:"edit",children:(0,i.tZ)(f.a.Card,{children:(0,i.tZ)(te,{})})})]})}):null},ie=e=>{const{user:t,...o}=e;return(0,i.tZ)(s.AvatarUploader,{...o,title:(0,c.u1)("userProfile.profilePage.imageFormTitle"),avatarPreview:(0,i.tZ)(s.UserAvatar,{size:e=>e.sizes.$12,...t})})},re=(0,s.withCardStateProvider)((e=>{const{onSuccess:t,onReset:o}=e,r=(0,s.useCardState)(),{user:l}=(0,p.aF)();if(!l)return null;const{first_name:c,last_name:d}=(0,n.useEnvironment)().userSettings.attributes,u=c.enabled,m=d.enabled,f=l.firstName||"",v=l.lastName||"",P=(0,g.Yp)("firstName",l.firstName||"",{type:"text",label:(0,a.localizationKeys)("formFieldLabel__firstName"),placeholder:(0,a.localizationKeys)("formFieldInputPlaceholder__firstName"),isRequired:d.required}),y=(0,g.Yp)("lastName",l.lastName||"",{type:"text",label:(0,a.localizationKeys)("formFieldLabel__lastName"),placeholder:(0,a.localizationKeys)("formFieldInputPlaceholder__lastName"),isRequired:d.required}),Z=u&&P.value!==f||m&&y.value!==v,S=Z,b=u&&c.required||m&&d.required,C=b&&!!y.value&&!!P.value&&S,z=l.samlAccounts.some((e=>e.active));return(0,i.BX)(s.FormContainer,{headerTitle:(0,a.localizationKeys)("userProfile.profilePage.title"),children:[z&&(0,i.tZ)(s.InformationBox,{message:(0,a.localizationKeys)("userProfile.profilePage.readonly")}),(0,i.BX)(s.Form.Root,{onSubmit:async e=>(e.preventDefault(),(Z?l.update({firstName:P.value,lastName:y.value}):Promise.resolve()).then(t).catch((e=>{(0,g.S3)(e,[P,y],r.setError)}))),sx:e=>({gap:e.space.$6}),children:[(0,i.tZ)(ie,{user:l,onAvatarChange:e=>l.setProfileImage({file:e}).then((()=>{r.setIdle()})).catch((e=>(0,g.S3)(e,[],r.setError))),onAvatarRemove:(0,h.QO)(l.imageUrl)?null:()=>{l.setProfileImage({file:null}).then((()=>{r.setIdle()})).catch((e=>(0,g.S3)(e,[],r.setError)))}}),(u||m)&&(0,i.BX)(s.Form.ControlRow,{elementId:"name",children:[u&&(0,i.tZ)(s.Form.PlainInput,{...P.props,isDisabled:z,autoFocus:!0}),m&&(0,i.tZ)(s.Form.PlainInput,{...y.props,isDisabled:z,autoFocus:!u})]}),(0,i.tZ)(s.FormButtons,{isDisabled:b?!C:!S,onReset:o})]})]})})),ne=()=>{const{close:e}=(0,v.XC)();return(0,i.tZ)(re,{onSuccess:e,onReset:e})},ae=()=>{const{user:e}=(0,p.aF)();if(!e)return null;const{username:t,primaryEmailAddress:o,primaryPhoneNumber:r,...n}=e;return(0,i.tZ)(s.ProfileSection.Root,{title:(0,a.localizationKeys)("userProfile.start.profileSection.title"),id:"profile",sx:{[J.mqu.md]:{alignItems:"flex-start"}},children:(0,i.BX)(f.a.Root,{children:[(0,i.tZ)(f.a.Closed,{value:"edit",children:(0,i.BX)(s.ProfileSection.Item,{id:"profile",children:[(0,i.tZ)(s.UserPreview,{user:n,size:"lg",mainIdentifierVariant:"subtitle",sx:e=>({color:e.colors.$colorText})}),(0,i.tZ)(f.a.Trigger,{value:"edit",children:(0,i.tZ)(s.ProfileSection.Button,{id:"profile",localizationKey:(0,a.localizationKeys)("userProfile.start.profileSection.primaryButton")})})]})}),(0,i.tZ)(f.a.Open,{value:"edit",children:(0,i.tZ)(f.a.Card,{children:(0,i.tZ)(ne,{})})})]})})};var se=o(8621);const le=(0,s.withCardStateProvider)((()=>{const e=(0,s.useCardState)(),{user:t}=(0,p.aF)(),{strategyToDisplayData:o}=(0,P.vO)(),r=0===(null==t?void 0:t.web3Wallets.filter((e=>{var t;return"verified"===(null===(t=e.verification)||void 0===t?void 0:t.status)})).length)?["web3_metamask_signature"]:[];return 0===r.length?null:(0,i.tZ)(s.ProfileSection.ActionMenu,{id:"web3Wallets",triggerLocalizationKey:(0,a.localizationKeys)("userProfile.start.web3WalletsSection.primaryButton"),children:r.map((r=>(0,i.tZ)(s.ProfileSection.ActionMenuItem,{id:o[r].id,onClick:()=>(async o=>{try{e.setLoading(o);const i=await(0,se.M)();if(!t)throw new Error("user is not defined");let r=await t.createWeb3Wallet({web3Wallet:i});r=await r.prepareVerification({strategy:"web3_metamask_signature"});const n=r.verification.nonce,a=await(0,se.w)({identifier:i,nonce:n});await r.attemptVerification({signature:a}),e.setIdle()}catch(i){e.setIdle(),console.log(i);const t=(0,g.zQ)(i);t?e.setError(t.longMessage):(0,g.S3)(i,[],e.setError)}})(r),isLoading:e.loadingMetadata===r,isDisabled:e.isLoading,localizationKey:`Connect ${o[r].name} wallet`,leftIcon:(0,i.tZ)(a.Image,{elementDescriptor:a.descriptors.providerIcon,elementId:a.descriptors.providerIcon.setId(o[r].id),isLoading:e.loadingMetadata===r,isDisabled:e.isLoading,src:o[r].iconUrl,alt:`Connect ${o[r].name}`,sx:e=>({width:e.sizes.$5})})},r)))})})),ce=e=>{const{close:t}=(0,v.XC)();return(0,i.tZ)(z,{onSuccess:t,onReset:t,...e})},de=(0,s.withCardStateProvider)((()=>{const{user:e}=(0,p.aF)(),t=(0,s.useCardState)(),{strategyToDisplayData:o}=(0,P.vO)();return(0,i.BX)(s.ProfileSection.Root,{title:(0,a.localizationKeys)("userProfile.start.web3WalletsSection.title"),id:"web3Wallets",children:[(0,i.tZ)(s.Card.Alert,{children:t.error}),(0,i.BX)(f.a.Root,{children:[(0,i.tZ)(s.ProfileSection.ItemList,{id:"web3Wallets",children:null==e?void 0:e.web3Wallets.map((e=>{const t=e.verification.strategy;return o[t]&&(0,i.BX)(f.a.Root,{children:[(0,i.tZ)(f.a.Closed,{value:"",children:(0,i.BX)(s.ProfileSection.Item,{id:"web3Wallets",align:"start",children:[(0,i.BX)(a.Flex,{sx:e=>({alignItems:"center",gap:e.space.$2,width:"100%"}),children:[o[t].iconUrl&&(0,i.tZ)(a.Image,{src:o[t].iconUrl,alt:o[t].name,sx:e=>({width:e.sizes.$4})}),(0,i.tZ)(a.Box,{sx:{whiteSpace:"nowrap",overflow:"hidden"},children:(0,i.tZ)(a.Flex,{gap:2,justify:"start",children:(0,i.BX)(a.Text,{children:[o[t].name," (",e.web3Wallet,")"]})})})]}),(0,i.tZ)(ue,{})]},e.id)}),(0,i.tZ)(f.a.Open,{value:"remove",children:(0,i.tZ)(f.a.Card,{variant:"destructive",children:(0,i.tZ)(ce,{walletId:e.id})})})]},e.id)}))}),(0,i.tZ)(le,{})]})]})})),ue=()=>{const{open:e}=(0,v.XC)(),t=[{label:(0,a.localizationKeys)("userProfile.start.web3WalletsSection.destructiveAction"),onClick:()=>e("remove")}].filter((e=>null!==e));return(0,i.tZ)(s.ThreeDotsMenu,{actions:t})},me=(0,s.withCardStateProvider)((()=>{const{attributes:e,saml:t,social:o}=(0,n.useEnvironment)().userSettings,r=(0,s.useCardState)(),{user:l}=(0,p.aF)(),c=e.username.enabled,d=e.email_address.enabled,u=e.phone_number.enabled,m=o&&Object.values(o).filter((e=>e.enabled)).length>0,h=t&&t.enabled&&l&&l.samlAccounts.length>0,f=e.web3_wallet.enabled;return(0,i.tZ)(a.Col,{elementDescriptor:a.descriptors.page,sx:e=>({gap:e.space.$8,color:e.colors.$colorText}),children:(0,i.BX)(a.Col,{elementDescriptor:a.descriptors.profilePage,elementId:a.descriptors.profilePage.setId("account"),children:[(0,i.tZ)(s.Header.Root,{children:(0,i.tZ)(s.Header.Title,{localizationKey:(0,a.localizationKeys)("userProfile.start.headerTitle__account"),sx:e=>({marginBottom:e.space.$4}),textVariant:"h2"})}),(0,i.tZ)(s.Card.Alert,{children:r.error}),(0,i.tZ)(ae,{}),c&&(0,i.tZ)(oe,{}),d&&(0,i.tZ)(M,{}),u&&(0,i.tZ)(Q,{}),m&&(0,i.tZ)(w,{}),h&&(0,i.tZ)(q,{}),f&&(0,i.tZ)(de,{})]})})}));var pe=o(7790);const he=()=>{const{user:e}=(0,p.aF)(),{session:t}=(0,p.kP)(),{data:o,isLoading:r}=(0,P.ib)(null==e?void 0:e.getSessions,"user-sessions");return(0,i.tZ)(s.ProfileSection.Root,{title:(0,a.localizationKeys)("userProfile.start.activeDevicesSection.title"),centered:!1,id:"activeDevices",children:(0,i.tZ)(s.ProfileSection.ItemList,{id:"activeDevices",disableAnimation:!0,children:r?(0,i.tZ)(s.FullHeightLoader,{}):null==o?void 0:o.sort((n=t.id,e=>e.id===n?-1:1)).map((e=>(0,i.tZ)(fe,{session:e},e.id)))})});var n},fe=({session:e})=>{var t;const o=(null===(t=(0,p.kP)().session)||void 0===t?void 0:t.id)===e.id,r=(0,P._m)();return(0,i.BX)(s.ProfileSection.Item,{id:"activeDevices",elementDescriptor:a.descriptors.activeDeviceListItem,elementId:o?a.descriptors.activeDeviceListItem.setId("current"):void 0,sx:{alignItems:"flex-start"},children:[r.isLoading&&(0,i.tZ)(s.FullHeightLoader,{}),!r.isLoading&&(0,i.BX)(i.HY,{children:[(0,i.tZ)(ve,{session:e}),!o&&(0,i.tZ)(Pe,{revoke:async()=>{if(!o&&e)return r.setLoading(),e.revoke().finally((()=>r.setIdle()))}})]})]})},ve=e=>{const{session:t}=(0,p.kP)(),o=(null==t?void 0:t.id)===e.session.id,r=!!(null==t?void 0:t.actor),n=!!e.session.actor,{city:s,country:l,browserName:c,browserVersion:d,deviceType:u,ipAddress:m,isMobile:h}=e.session.latestActivity,f=u||(h?"Mobile device":"Desktop device"),v=`${c||""} ${d||""}`.trim()||"Web browser",P=[s||"",l||""].filter(Boolean).join(", ").trim()||null,{t:y}=(0,a.useLocalizations)();return(0,i.BX)(a.Flex,{elementDescriptor:a.descriptors.activeDevice,elementId:o?a.descriptors.activeDevice.setId("current"):void 0,sx:e=>({width:"100%",overflow:"hidden",gap:e.space.$4,[J.mqu.sm]:{gap:e.space.$2}}),children:[(0,i.tZ)(a.Flex,{sx:e=>({[J.mqu.sm]:{padding:"0"},borderRadius:e.radii.$md}),children:(0,i.tZ)(a.Icon,{elementDescriptor:a.descriptors.activeDeviceIcon,elementId:a.descriptors.activeDeviceIcon.setId(h?"mobile":"desktop"),icon:h?pe.Fh:pe.eu,sx:e=>({"--cl-chassis-bottom":"#444444","--cl-chassis-back":"#343434","--cl-chassis-screen":"#575757","--cl-screen":"#000000",width:e.space.$8,height:e.space.$8})})}),(0,i.BX)(a.Col,{align:"start",gap:1,children:[(0,i.BX)(a.Flex,{center:!0,gap:2,children:[(0,i.tZ)(a.Text,{children:f}),o&&(0,i.tZ)(a.Badge,{localizationKey:(0,a.localizationKeys)("badge__thisDevice"),colorScheme:r?"danger":"primary"}),r&&!n&&(0,i.tZ)(a.Badge,{localizationKey:(0,a.localizationKeys)("badge__userDevice")}),!o&&n&&(0,i.tZ)(a.Badge,{localizationKey:(0,a.localizationKeys)("badge__otherImpersonatorDevice"),colorScheme:"danger"})]}),(0,i.tZ)(a.Text,{colorScheme:"secondary",children:v}),(0,i.BX)(a.Text,{colorScheme:"secondary",children:[m," (",P,")"]}),(0,i.tZ)(a.Text,{colorScheme:"secondary",children:y((0,g.Qg)(e.session.lastActiveAt))})]})]})},Pe=({revoke:e})=>{const t=[{label:(0,a.localizationKeys)("userProfile.start.activeDevicesSection.destructiveAction"),isDestructive:!0,onClick:e}].filter((e=>null!==e));return(0,i.tZ)(s.ThreeDotsMenu,{actions:t})},ge=(0,s.withCardStateProvider)((e=>{const{onReset:t}=e,o=(0,s.useCardState)(),{navigateAfterSignOut:r}=(0,n.useSignOutContext)(),{user:l}=(0,p.aF)(),{t:c}=(0,a.useLocalizations)(),d=(0,g.Yp)("deleteConfirmation","",{type:"text",label:(0,a.localizationKeys)("userProfile.deletePage.actionDescription"),isRequired:!0,placeholder:(0,a.localizationKeys)("formFieldInputPlaceholder__confirmDeletionUserAccount")}),u=d.value===(c((0,a.localizationKeys)("formFieldInputPlaceholder__confirmDeletionUserAccount"))||"Delete account");return(0,i.tZ)(s.FormContainer,{headerTitle:(0,a.localizationKeys)("userProfile.deletePage.title"),sx:e=>({gap:e.space.$0x5}),children:(0,i.BX)(s.Form.Root,{onSubmit:async()=>{if(u)try{if(!l)throw Error("user is not defined");await l.delete(),await r()}catch(e){(0,g.S3)(e,[],o.setError)}},children:[(0,i.BX)(a.Col,{gap:1,children:[(0,i.tZ)(a.Text,{colorScheme:"secondary",localizationKey:(0,a.localizationKeys)("userProfile.deletePage.messageLine1")}),(0,i.tZ)(a.Text,{colorScheme:"danger",localizationKey:(0,a.localizationKeys)("userProfile.deletePage.messageLine2")})]}),(0,i.tZ)(s.Form.ControlRow,{elementId:d.id,children:(0,i.tZ)(s.Form.PlainInput,{...d.props,ignorePasswordManager:!0})}),(0,i.tZ)(s.FormButtons,{submitLabel:(0,a.localizationKeys)("userProfile.deletePage.confirm"),colorScheme:"danger",isDisabled:!u,onReset:t})]})})})),ye=()=>{const{close:e}=(0,v.XC)();return(0,i.tZ)(ge,{onSuccess:e,onReset:e})},Ze=()=>(0,i.tZ)(s.ProfileSection.Root,{title:(0,a.localizationKeys)("userProfile.start.dangerSection.title"),id:"danger",sx:{alignItems:"center",[J.mqu.md]:{alignItems:"flex-start"}},children:(0,i.BX)(f.a.Root,{children:[(0,i.tZ)(f.a.Closed,{value:"delete",children:(0,i.tZ)(s.ProfileSection.Item,{id:"danger",sx:e=>({paddingLeft:e.space.$1}),children:(0,i.tZ)(f.a.Trigger,{value:"delete",children:(0,i.tZ)(s.ProfileSection.Button,{id:"danger",variant:"ghost",colorScheme:"danger",localizationKey:(0,a.localizationKeys)("userProfile.start.dangerSection.deleteAccountButton")})})})}),(0,i.tZ)(f.a.Open,{value:"delete",children:(0,i.tZ)(f.a.Card,{variant:"destructive",children:(0,i.tZ)(ye,{})})})]})});var Se=o(4016);const be=e=>{const{code:t}=e;return(0,i.tZ)(a.Flex,{center:!0,sx:e=>({padding:`${e.space.$1} ${e.space.$4}`}),children:(0,i.tZ)(a.Text,{children:t})})},Ce=e=>{const{subtitle:t,backupCodes:o}=e,{applicationName:r}=(0,n.useEnvironment)().displayConfig,{user:s}=(0,p.aF)(),{print:l,printableProps:c}=(0,Z.Qz)(),{onCopy:d,hasCopied:u}=(0,P.VP)((null==o?void 0:o.join(","))||"");if(!s)return null;const m=(0,Se.xC)(s);return o?(0,i.BX)(i.HY,{children:[(0,i.BX)(a.Col,{gap:1,children:[(0,i.tZ)(a.Text,{localizationKey:(0,a.localizationKeys)("userProfile.backupCodePage.title__codelist"),variant:"subtitle"}),(0,i.tZ)(a.Text,{localizationKey:t,variant:"caption",colorScheme:"secondary"})]}),(0,i.BX)(a.Box,{sx:e=>({borderWidth:e.borderWidths.$normal,borderStyle:e.borderStyles.$solid,borderColor:e.colors.$neutralAlpha100,borderRadius:e.radii.$lg}),children:[(0,i.tZ)(a.Grid,{gap:2,sx:e=>({gridTemplateColumns:`repeat(2, minmax(${e.sizes.$12}, 1fr))`,padding:`${e.space.$4} ${e.space.$6}`}),children:o.map(((e,t)=>(0,i.tZ)(be,{code:e},t)))}),(0,i.BX)(a.Grid,{sx:e=>({borderTopWidth:e.borderWidths.$normal,borderTopStyle:e.borderStyles.$solid,borderTopColor:e.colors.$neutralAlpha100,gridTemplateColumns:"repeat(3, minmax(0, 1fr))",">:not([hidden])~:not([hidden])":{borderRightWidth:"0px",borderLeftWidth:"1px",borderStyle:"solid",borderColor:e.colors.$neutralAlpha100},">:first-child":{borderBottomLeftRadius:e.radii.$lg},">:last-child":{borderBottomRightRadius:e.radii.$lg}}),children:[(0,i.tZ)(a.Button,{variant:"ghost",sx:e=>({width:"100%",padding:`${e.space.$2} 0`,borderRadius:0}),onClick:()=>{const e=document.createElement("a"),t=new Blob([ze(o,r,m)],{type:"text/plain"});e.href=URL.createObjectURL(t),e.download=`${r}_backup_codes.txt`,document.body.appendChild(e),e.click()},children:(0,i.tZ)(a.Icon,{icon:pe.UW})}),(0,i.tZ)(a.Button,{variant:"ghost",sx:e=>({width:"100%",padding:`${e.space.$2} 0`,borderRadius:0}),onClick:l,children:(0,i.tZ)(a.Icon,{icon:pe.Kh})}),(0,i.tZ)(a.Button,{variant:"ghost",onClick:d,sx:e=>({width:"100%",padding:`${e.space.$2} 0`,borderRadius:0}),children:(0,i.tZ)(a.Icon,{icon:u?pe.Jr:pe.CK})})]})]}),(0,i.BX)(Z.o4,{...c,children:[(0,i.BX)(a.Heading,{children:["Your backup codes for ",r," account ",m,":"]}),(0,i.tZ)(a.Col,{gap:2,children:o.map(((e,t)=>(0,i.tZ)(be,{code:e},t)))})]})]}):null};function ze(e,t,o){return`These are your backup codes for ${t} account ${o}.\nStore them securely and keep them secret. Each code can only be used once.\n\n${null==e?void 0:e.join("\n")}`}const Re=(0,s.withCardStateProvider)((e=>{const{onSuccess:t}=e,{user:o}=(0,p.aF)(),n=(0,s.useCardState)(),[l,c]=r.useState(void 0);return r.useEffect((()=>{l||null==o||o.createBackupCode().then((e=>c(e))).catch((e=>(0,g.S3)(e,[],n.setError)))}),[]),n.error?(0,i.tZ)(s.FormContainer,{headerTitle:(0,a.localizationKeys)("userProfile.backupCodePage.title")}):(0,i.tZ)(s.FormContainer,{headerTitle:(0,a.localizationKeys)("userProfile.backupCodePage.title"),children:l?(0,i.BX)(i.HY,{children:[(0,i.tZ)(a.Text,{localizationKey:(0,a.localizationKeys)("userProfile.backupCodePage.successMessage")}),(0,i.tZ)(Ce,{subtitle:(0,a.localizationKeys)("userProfile.backupCodePage.subtitle__codelist"),backupCodes:l.codes}),(0,i.tZ)(s.FormButtonContainer,{children:(0,i.tZ)(a.Button,{autoFocus:!0,onClick:t,localizationKey:(0,a.localizationKeys)("userProfile.formButtonPrimary__finish"),elementDescriptor:a.descriptors.formButtonPrimary})})]}):(0,i.tZ)(s.FullHeightLoader,{})})})),Ke=(0,s.withCardStateProvider)((e=>{const{onSuccess:t,onReset:o}=e,r=(0,Z.a2)();return(0,i.BX)(Z.en,{...r.props,children:[(0,i.tZ)(Be,{onContinue:r.nextStep}),(0,i.tZ)(Re,{onSuccess:t,onReset:o})]})})),Be=e=>{const{onContinue:t}=e,{close:o}=(0,v.XC)();return(0,i.BX)(s.FormContainer,{headerTitle:(0,a.localizationKeys)("userProfile.backupCodePage.title"),children:[(0,i.tZ)(a.Text,{localizationKey:(0,a.localizationKeys)("userProfile.backupCodePage.infoText1")}),(0,i.tZ)(a.Text,{localizationKey:(0,a.localizationKeys)("userProfile.backupCodePage.infoText2")}),(0,i.BX)(s.FormButtonContainer,{sx:{marginTop:0},children:[(0,i.tZ)(a.Button,{textVariant:"buttonSmall",onClick:t,localizationKey:(0,a.localizationKeys)("userProfile.formButtonPrimary__finish"),elementDescriptor:a.descriptors.formButtonPrimary}),(0,i.tZ)(a.Button,{variant:"ghost",onClick:o,localizationKey:(0,a.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:a.descriptors.formButtonReset})]})]})},xe=(0,s.withCardStateProvider)((e=>{var t;const{onReset:o,onSuccess:l}=e,c=r.useRef(),d=(0,Z.a2)({defaultStep:2}),u=(0,n.useEnvironment)().userSettings.attributes.backup_code.enabled;return(0,i.BX)(Z.en,{...d.props,children:[(0,i.tZ)(Y,{title:(0,a.localizationKeys)("userProfile.phoneNumberPage.title"),resourceRef:c,onSuccess:d.nextStep,onUseExistingNumberClick:()=>d.goToStep(2),onReset:o}),(0,i.tZ)(V,{title:(0,a.localizationKeys)("userProfile.mfaPhoneCodePage.title"),resourceRef:c,onSuccess:d.nextStep,onReset:d.prevStep}),(0,i.tZ)(we,{onSuccess:u?d.nextStep:l,onReset:o,onAddPhoneClick:()=>d.goToStep(0),onUnverifiedPhoneClick:e=>{c.current=e,d.goToStep(1)},title:(0,a.localizationKeys)("userProfile.mfaPhoneCodePage.title"),resourceRef:c}),u&&(0,i.tZ)(s.SuccessPage,{title:(0,a.localizationKeys)("userProfile.mfaPhoneCodePage.successTitle"),text:[(0,a.localizationKeys)("userProfile.mfaPhoneCodePage.successMessage1"),(0,a.localizationKeys)("userProfile.mfaPhoneCodePage.successMessage2")],onFinish:o,contents:(0,i.tZ)(Ce,{backupCodes:null===(t=c.current)||void 0===t?void 0:t.backupCodes})})]})})),we=e=>{const{onSuccess:t,onReset:o,title:r,onAddPhoneClick:n,onUnverifiedPhoneClick:l,resourceRef:c}=e,d=(0,s.useCardState)(),{user:u}=(0,p.aF)();if(!u)return null;const m=u.phoneNumbers.filter((e=>!e.reservedForSecondFactor));return(0,i.BX)(s.FormContainer,{headerTitle:r,gap:1,children:[(0,i.tZ)(a.Text,{localizationKey:(0,a.localizationKeys)(m.length?"userProfile.mfaPhoneCodePage.subtitle__availablePhoneNumbers":"userProfile.mfaPhoneCodePage.subtitle__unavailablePhoneNumbers"),colorScheme:"secondary"}),m.length>0&&(0,i.tZ)(a.Col,{gap:2,children:m.map((e=>{const{country:o}=(0,g.Z_)(e.phoneNumber),r=(0,g.L_)(e.phoneNumber);return(0,i.BX)(a.Button,{variant:"outline",colorScheme:"neutral",sx:{justifyContent:"start"},onClick:()=>(async e=>{if("verified"!==e.verification.status)return l(e);d.setLoading(e.id);try{await e.setReservedForSecondFactor({reserved:!0}).then((()=>{c.current=e,t()}))}catch(o){(0,g.S3)(o,[],d.setError)}finally{d.setIdle()}})(e),isLoading:d.loadingMetadata===e.id,isDisabled:d.isLoading,children:[o.iso.toUpperCase()," ",r]},e.id)}))}),(0,i.BX)(s.FormButtonContainer,{sx:{flexDirection:"row",justifyContent:"space-between"},children:[(0,i.tZ)(s.IconButton,{variant:"ghost","aria-label":"Add phone number",icon:(0,i.tZ)(a.Icon,{icon:pe.v3,sx:e=>({marginRight:e.space.$2})}),localizationKey:(0,a.localizationKeys)("userProfile.mfaPhoneCodePage.primaryButton__addPhoneNumber"),onClick:n}),(0,i.tZ)(a.Button,{variant:"ghost",localizationKey:(0,a.localizationKeys)("userProfile.formButtonReset"),onClick:o})]})]})},_e=(0,s.withCardStateProvider)((e=>{const{title:t,onSuccess:o,onReset:n}=e,{user:l}=(0,p.aF)(),c=(0,s.useCardState)(),[d,u]=r.useState(void 0),[m,h]=r.useState("qr");return r.useEffect((()=>{null==l||l.createTOTP().then((e=>u(e))).catch((e=>(0,g.S3)(e,[],c.setError)))}),[]),c.error?(0,i.tZ)(s.FormContainer,{headerTitle:t}):(0,i.BX)(s.FormContainer,{headerTitle:t,headerSubtitle:"qr"==m?(0,a.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.infoText__ableToScan"):(0,a.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.infoText__unableToScan"),children:[!d&&(0,i.tZ)(s.FullHeightLoader,{}),d&&(0,i.BX)(i.HY,{children:[(0,i.BX)(a.Col,{gap:4,children:["qr"==m&&(0,i.tZ)(Z.s_,{justify:"center",url:d.uri||""}),"uri"==m&&(0,i.BX)(i.HY,{children:[(0,i.tZ)(a.Text,{colorScheme:"secondary",localizationKey:(0,a.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.inputLabel__unableToScan1")}),(0,i.tZ)(s.ClipboardInput,{value:d.secret}),(0,i.tZ)(a.Text,{colorScheme:"secondary",localizationKey:(0,a.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.inputLabel__unableToScan2")}),(0,i.tZ)(s.ClipboardInput,{value:d.uri})]})]}),(0,i.BX)(a.Flex,{justify:"between",align:"center",sx:{width:"100%"},children:["qr"==m&&(0,i.tZ)(a.Button,{variant:"link",textVariant:"buttonLarge",onClick:()=>h("uri"),localizationKey:(0,a.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.buttonUnableToScan__nonPrimary")}),"uri"==m&&(0,i.tZ)(a.Button,{variant:"link",textVariant:"buttonLarge",onClick:()=>h("qr"),localizationKey:(0,a.localizationKeys)("userProfile.mfaTOTPPage.authenticatorApp.buttonAbleToScan__nonPrimary")}),(0,i.BX)(s.FormButtonContainer,{children:[(0,i.tZ)(a.Button,{onClick:o,localizationKey:(0,a.localizationKeys)("userProfile.formButtonPrimary__continue"),elementDescriptor:a.descriptors.formButtonPrimary}),(0,i.tZ)(a.Button,{variant:"ghost",onClick:n,localizationKey:(0,a.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:a.descriptors.formButtonReset})]})]})]})]})})),Fe=(0,s.withCardStateProvider)((e=>{const{onSuccess:t,onReset:o,resourceRef:r}=e,{user:n}=(0,p.aF)(),l=(0,s.useFieldOTP)({onCodeEntryFinished:(e,t,o)=>{null==n||n.verifyTOTP({code:e}).then((e=>t(e))).catch(o)},onResolve:e=>{r.current=e,t()}});return(0,i.BX)(s.FormContainer,{headerTitle:(0,a.localizationKeys)("userProfile.mfaTOTPPage.title"),children:[(0,i.tZ)(a.Col,{children:(0,i.tZ)(s.Form.OTPInput,{...l,label:(0,a.localizationKeys)("userProfile.mfaTOTPPage.verifyTitle"),description:(0,a.localizationKeys)("userProfile.mfaTOTPPage.verifySubtitle")})}),(0,i.tZ)(s.FormButtonContainer,{sx:{marginTop:0},children:(0,i.tZ)(a.Button,{onClick:o,variant:"ghost",isDisabled:l.isLoading,localizationKey:(0,a.localizationKeys)("userProfile.formButtonReset"),elementDescriptor:a.descriptors.formButtonReset})})]})})),Te=(0,s.withCardStateProvider)((e=>{var t;const{onReset:o}=e,n=(0,Z.a2)(),l=r.useRef();return(0,i.BX)(Z.en,{...n.props,children:[(0,i.tZ)(_e,{title:(0,a.localizationKeys)("userProfile.mfaTOTPPage.title"),onSuccess:n.nextStep,onReset:o}),(0,i.tZ)(Fe,{onSuccess:n.nextStep,onReset:o,resourceRef:l}),(0,i.tZ)(s.SuccessPage,{title:(0,a.localizationKeys)("userProfile.mfaTOTPPage.title"),text:(0,a.localizationKeys)("userProfile.mfaTOTPPage.successMessage"),onFinish:o,contents:(0,i.tZ)(Ce,{subtitle:(0,a.localizationKeys)("userProfile.backupCodePage.successSubtitle"),backupCodes:null===(t=l.current)||void 0===t?void 0:t.backupCodes})})]})})),ke=(0,s.withCardStateProvider)((e=>{const{onSuccess:t,onReset:o,selectedStrategy:l}=e,c=(0,s.useCardState)(),{userSettings:{attributes:d}}=(0,n.useEnvironment)(),{user:u}=(0,p.aF)();if(!u)return null;const m=(0,a.localizationKeys)("userProfile.mfaPage.title"),h=r.useMemo((()=>A(d,u)),[]);return r.useEffect((()=>{0===h.length&&c.setError("There are no second factors available to add")}),[]),c.error?(0,i.tZ)(s.FormContainer,{headerTitle:m}):0!==h.length||l?(0,i.tZ)(Ae,{onSuccess:t,onReset:o,method:l||h[0]}):null})),Ae=e=>{const{method:t,onSuccess:o,onReset:r}=e;switch(t){case"phone_code":return(0,i.tZ)(xe,{onSuccess:o,onReset:r});case"totp":return(0,i.tZ)(Te,{onSuccess:o,onReset:r});case"backup_code":return(0,i.tZ)(Ke,{onSuccess:o,onReset:r});default:return null}},Ie=()=>{const{close:e}=(0,v.XC)();return(0,i.tZ)(K,{onSuccess:e,onReset:e})},Xe=e=>{const{close:t}=(0,v.XC)();return(0,i.tZ)(R,{onSuccess:t,onReset:t,...e})},Le=()=>{const{close:e}=(0,v.XC)();return(0,i.tZ)(Re,{onSuccess:e,onReset:e})},De=e=>{const{close:t}=(0,v.XC)();return(0,i.tZ)(ke,{onSuccess:t,onReset:t,selectedStrategy:e.selectedStrategy})},$e=()=>{const{userSettings:{attributes:e}}=(0,n.useEnvironment)(),{user:t}=(0,p.aF)();if(!t)return null;const o=k(e),r=A(e,t),l=o.includes("totp")&&t.totpEnabled,c=o.includes("backup_code")&&t.backupCodeEnabled,d=t.phoneNumbers.filter((e=>"verified"===e.verification.status)).filter((e=>e.reservedForSecondFactor)).sort(T);return(0,i.tZ)(s.ProfileSection.Root,{title:(0,a.localizationKeys)("userProfile.start.mfaSection.title"),centered:!1,id:"mfa",children:(0,i.tZ)(f.a.Root,{children:(0,i.BX)(s.ProfileSection.ItemList,{id:"mfa",children:[l&&(0,i.BX)(f.a.Root,{children:[(0,i.BX)(s.ProfileSection.Item,{id:"mfa",hoverable:!0,children:[(0,i.BX)(a.Flex,{sx:e=>({gap:e.space.$2,alignItems:"center"}),children:[(0,i.tZ)(a.Icon,{icon:pe.hc,sx:e=>({color:e.colors.$neutralAlpha700})}),(0,i.tZ)(a.Text,{localizationKey:(0,a.localizationKeys)("userProfile.start.mfaSection.totp.headerTitle")}),(0,i.tZ)(a.Badge,{localizationKey:(0,a.localizationKeys)("badge__default")})]}),(0,i.tZ)(Oe,{})]}),(0,i.tZ)(f.a.Open,{value:"remove",children:(0,i.tZ)(f.a.Card,{variant:"destructive",children:(0,i.tZ)(Ie,{})})})]}),o.includes("phone_code")&&d.map((e=>{const t=!l&&e.defaultSecondFactor;return(0,i.BX)(f.a.Root,{children:[(0,i.BX)(s.ProfileSection.Item,{id:"mfa",hoverable:!0,children:[(0,i.BX)(a.Flex,{sx:e=>({gap:e.space.$2,alignItems:"center"}),children:[(0,i.tZ)(a.Icon,{icon:pe.ij,sx:e=>({color:e.colors.$neutralAlpha700})}),(0,i.BX)(a.Text,{children:["SMS Code ",(0,i.tZ)(s.FormattedPhoneNumberText,{value:e.phoneNumber})]}),t&&(0,i.tZ)(a.Badge,{localizationKey:(0,a.localizationKeys)("badge__default")})]}),(0,i.tZ)(Ee,{phone:e,showTOTP:l})]}),(0,i.tZ)(f.a.Open,{value:"remove",children:(0,i.tZ)(f.a.Card,{variant:"destructive",children:(0,i.tZ)(Xe,{phoneId:e.id})})})]},e.id)})),c&&(0,i.BX)(f.a.Root,{children:[(0,i.BX)(s.ProfileSection.Item,{id:"mfa",hoverable:!0,children:[(0,i.BX)(a.Flex,{sx:e=>({gap:e.space.$2,alignItems:"center"}),children:[(0,i.tZ)(a.Icon,{icon:pe.Qi,sx:e=>({color:e.colors.$neutralAlpha700})}),(0,i.tZ)(a.Text,{localizationKey:(0,a.localizationKeys)("userProfile.start.mfaSection.backupCodes.headerTitle")})]}),(0,i.tZ)(Ne,{})]}),(0,i.tZ)(f.a.Open,{value:"regenerate",children:(0,i.tZ)(f.a.Card,{children:(0,i.tZ)(Le,{})})})]}),(0,i.tZ)(Me,{secondFactorsAvailableToAdd:r})]})})})},Ee=({phone:e,showTOTP:t})=>{const{open:o}=(0,v.XC)(),r=(0,s.useCardState)(),n=[t?{label:(0,a.localizationKeys)("userProfile.start.mfaSection.phoneCode.actionLabel__setDefault"),onClick:()=>e.makeDefaultSecondFactor().catch((e=>(0,g.S3)(e,[],r.setError)))}:null,{label:(0,a.localizationKeys)("userProfile.start.mfaSection.phoneCode.destructiveActionLabel"),isDestructive:!0,onClick:()=>o("remove")}].filter((e=>null!==e));return(0,i.tZ)(s.ThreeDotsMenu,{actions:n})},Ne=()=>{const{open:e}=(0,v.XC)(),t=[{label:(0,a.localizationKeys)("userProfile.start.mfaSection.backupCodes.actionLabel__regenerate"),onClick:()=>e("regenerate")}].filter((e=>null!==e));return(0,i.tZ)(s.ThreeDotsMenu,{actions:t})},Oe=()=>{const{open:e}=(0,v.XC)(),t=[{label:(0,a.localizationKeys)("userProfile.start.mfaSection.totp.destructiveActionTitle"),isDestructive:!0,onClick:()=>e("remove")}].filter((e=>null!==e));return(0,i.tZ)(s.ThreeDotsMenu,{actions:t})},Me=e=>{const{open:t}=(0,v.XC)(),{secondFactorsAvailableToAdd:o}=e,[n,l]=(0,r.useState)(),c=r.useMemo((()=>o.map((e=>"phone_code"===e?{icon:pe.ij,text:"SMS code",key:"phone_code"}:"totp"===e?{icon:pe.hc,text:"Authenticator application",key:"totp"}:"backup_code"===e?{icon:pe.Qi,text:"Backup code",key:"backup_code"}:null)).filter((e=>null!==e))),[o]);return(0,i.BX)(i.HY,{children:[o.length>0&&(0,i.tZ)(f.a.Closed,{value:"multi-factor",children:(0,i.tZ)(s.ProfileSection.ActionMenu,{id:"mfa",triggerLocalizationKey:(0,a.localizationKeys)("userProfile.start.mfaSection.primaryButton"),children:c.map((e=>e&&(0,i.tZ)(s.ProfileSection.ActionMenuItem,{id:e.key,localizationKey:e.text,leftIcon:e.icon,onClick:()=>{l(e.key),t("multi-factor")}},e.key)))})}),(0,i.tZ)(f.a.Open,{value:"multi-factor",children:(0,i.tZ)(f.a.Card,{children:n&&(0,i.tZ)(De,{selectedStrategy:n})})})]})},Ue=e=>{const{close:t}=(0,v.XC)();return(0,i.tZ)(B,{onSuccess:t,onReset:t,...e})},qe=e=>{const{close:t}=(0,v.XC)();return(0,i.tZ)(We,{onSuccess:t,onReset:t,passkey:e.passkey})},We=(0,s.withCardStateProvider)((e=>{const{onSuccess:t,onReset:o,passkey:r}=e,n=(0,s.useCardState)(),l=(0,g.Yp)("passkeyName",r.name||"",{type:"text",label:(0,a.localizationKeys)("formFieldLabel__passkeyName"),isRequired:!0}),c=l.value.length>1&&r.name!==l.value;return(0,i.tZ)(s.FormContainer,{headerTitle:(0,a.localizationKeys)("userProfile.passkeyScreen.title__rename"),headerSubtitle:(0,a.localizationKeys)("userProfile.passkeyScreen.subtitle__rename"),children:(0,i.BX)(s.Form.Root,{onSubmit:async e=>(e.preventDefault(),r.update({name:l.value}).then(t).catch((e=>(0,g.S3)(e,[l],n.setError)))),children:[(0,i.tZ)(s.Form.ControlRow,{elementId:l.id,children:(0,i.tZ)(s.Form.PlainInput,{...l.props,autoComplete:"off"})}),(0,i.tZ)(s.FormButtons,{submitLabel:(0,a.localizationKeys)("userProfile.formButtonPrimary__save"),isDisabled:!c,onReset:o})]})})})),Ye=()=>{const{user:e}=(0,p.aF)();return e?(0,i.tZ)(s.ProfileSection.Root,{title:(0,a.localizationKeys)("userProfile.start.passkeysSection.title"),centered:!1,id:"passkeys",children:(0,i.BX)(s.ProfileSection.ItemList,{id:"passkeys",children:[e.passkeys.map((e=>(0,i.BX)(f.a.Root,{children:[(0,i.tZ)(Ve,{...e},e.id),(0,i.tZ)(f.a.Open,{value:"remove",children:(0,i.tZ)(f.a.Card,{variant:"destructive",children:(0,i.tZ)(Ue,{passkey:e})})}),(0,i.tZ)(f.a.Open,{value:"rename",children:(0,i.tZ)(f.a.Card,{children:(0,i.tZ)(qe,{passkey:e})})})]},e.id))),(0,i.tZ)(Qe,{})]})}):null},Ve=e=>(0,i.BX)(s.ProfileSection.Item,{id:"passkeys",hoverable:!0,sx:{alignItems:"flex-start"},children:[(0,i.tZ)(je,{...e}),(0,i.tZ)(He,{})]}),je=e=>{const{name:t,createdAt:o,lastUsedAt:r}=e,{t:n}=(0,a.useLocalizations)();return(0,i.tZ)(a.Flex,{sx:e=>({width:"100%",overflow:"hidden",gap:e.space.$4,[J.mqu.sm]:{gap:e.space.$2}}),children:(0,i.BX)(a.Col,{align:"start",gap:1,children:[(0,i.tZ)(a.Text,{children:t}),(0,i.BX)(a.Text,{colorScheme:"secondary",children:["Created: ",n((0,g.Qg)(o))]}),r&&(0,i.BX)(a.Text,{colorScheme:"secondary",children:["Last used: ",n((0,g.Qg)(r))]})]})})},He=()=>{const{open:e}=(0,v.XC)(),t=[{label:(0,a.localizationKeys)("userProfile.start.passkeysSection.menuAction__rename"),onClick:()=>e("rename")},{label:(0,a.localizationKeys)("userProfile.start.passkeysSection.menuAction__destructive"),isDestructive:!0,onClick:()=>e("remove")}];return(0,i.tZ)(s.ThreeDotsMenu,{actions:t})},Qe=()=>{const e=(0,s.useCardState)(),{isSatellite:t}=(0,p.cL)(),{user:o}=(0,p.aF)();return t?null:(0,i.tZ)(s.ProfileSection.ArrowButton,{id:"passkeys",localizationKey:"Add a passkey",onClick:async()=>{try{await(null==o?void 0:o.createPasskey())}catch(t){(0,g.S3)(t,[],e.setError)}}})},Ge=(e,t)=>{const o=[];return e?o.push((0,a.localizationKeys)("userProfile.passwordPage.successMessage__update")):o.push((0,a.localizationKeys)("userProfile.passwordPage.successMessage__set")),t&&o.push((0,a.localizationKeys)("userProfile.passwordPage.successMessage__signOutOfOtherSessions")),o},Je=(0,s.withCardStateProvider)((e=>{const{onSuccess:t,onReset:o}=e,{user:l}=(0,p.aF)();if(!l)return null;const{session:c}=(0,p.kP)(),d=l.passwordEnabled?(0,a.localizationKeys)("userProfile.passwordPage.title__update"):(0,a.localizationKeys)("userProfile.passwordPage.title__set"),u=(0,s.useCardState)(),m=l.samlAccounts.some((e=>e.active)),h=(0,r.useRef)({title:(0,a.localizationKeys)("userProfile.passwordPage.title__set")}),f=(0,g.Yp)("currentPassword","",{type:"password",label:(0,a.localizationKeys)("formFieldLabel__currentPassword"),isRequired:!0}),{userSettings:{passwordSettings:v}}=(0,n.useEnvironment)(),y=(0,g.Yp)("newPassword","",{type:"password",label:(0,a.localizationKeys)("formFieldLabel__newPassword"),isRequired:!0,validatePassword:!0,buildErrorMessage:e=>(0,g.GM)(e,{t:z,locale:R,passwordSettings:v})}),Z=(0,g.Yp)("confirmPassword","",{type:"password",label:(0,a.localizationKeys)("formFieldLabel__confirmPassword"),isRequired:!0}),S=(0,g.Yp)("signOutOfOtherSessions","",{type:"checkbox",label:(0,a.localizationKeys)("formFieldLabel__signOutOfOtherSessions"),defaultChecked:!0}),{setConfirmPasswordFeedback:b,isPasswordMatch:C}=(0,P.p5)({passwordField:y,confirmPasswordField:Z}),{t:z,locale:R}=(0,a.useLocalizations)(),K=(l.passwordEnabled?f.value&&C:C)&&y.value&&Z.value;return(0,i.BX)(s.FormContainer,{headerTitle:d,children:[m&&(0,i.tZ)(s.InformationBox,{message:(0,a.localizationKeys)("userProfile.passwordPage.readonly")}),(0,i.BX)(s.Form.Root,{onSubmit:async()=>{const e={newPassword:y.value,signOutOfOtherSessions:S.checked,currentPassword:l.passwordEnabled?f.value:void 0};try{h.current={title:l.passwordEnabled?(0,a.localizationKeys)("userProfile.passwordPage.title__update"):(0,a.localizationKeys)("userProfile.passwordPage.title__set"),text:Ge(l.passwordEnabled,!!S.checked)},await l.updatePassword(e),t()}catch(o){(0,g.S3)(o,[f,y,Z],u.setError)}},onBlur:()=>{y.value&&b(Z.value)},children:[(0,i.tZ)("input",{readOnly:!0,"data-testid":"hidden-identifier",id:"identifier-field",name:"identifier",value:(null==c?void 0:c.publicUserData.identifier)||"",style:{display:"none"}}),l.passwordEnabled&&(0,i.tZ)(s.Form.ControlRow,{elementId:f.id,children:(0,i.tZ)(s.Form.PasswordInput,{...f.props,minLength:6,isRequired:!0,autoFocus:!0,isDisabled:m})}),(0,i.tZ)(s.Form.ControlRow,{elementId:y.id,children:(0,i.tZ)(s.Form.PasswordInput,{...y.props,minLength:6,isRequired:!0,autoFocus:!l.passwordEnabled,isDisabled:m})}),(0,i.tZ)(s.Form.ControlRow,{elementId:Z.id,children:(0,i.tZ)(s.Form.PasswordInput,{...Z.props,onChange:e=>(e.target.value&&b(e.target.value),Z.props.onChange(e)),isRequired:!0,isDisabled:m})}),(0,i.tZ)(s.Form.ControlRow,{elementId:S.id,children:(0,i.tZ)(s.Form.Checkbox,{...S.props,description:(0,a.localizationKeys)("userProfile.passwordPage.checkboxInfoText__signOutOfOtherSessions"),isDisabled:m})}),m?(0,i.tZ)(s.FormButtonContainer,{children:(0,i.tZ)(s.Form.ResetButton,{localizationKey:(0,a.localizationKeys)("userProfile.formButtonReset"),block:!1,onClick:o})}):(0,i.tZ)(s.FormButtons,{isDisabled:!K,onReset:o})]})]})})),et=()=>{const{close:e}=(0,v.XC)();return(0,i.tZ)(Je,{onSuccess:e,onReset:e})},tt=()=>{const{user:e}=(0,p.aF)();if(!e)return null;const{passwordEnabled:t}=e;return(0,i.tZ)(s.ProfileSection.Root,{centered:!1,title:(0,a.localizationKeys)("userProfile.start.passwordSection.title"),id:"password",children:(0,i.BX)(f.a.Root,{children:[(0,i.tZ)(f.a.Closed,{value:"edit",children:(0,i.BX)(s.ProfileSection.Item,{id:"password",sx:e=>({paddingLeft:t?void 0:"0",paddingTop:e.space.$0x25,paddingBottom:e.space.$0x25}),children:[t&&(0,i.tZ)(a.Text,{variant:"h2",children:"••••••••••"}),(0,i.tZ)(f.a.Trigger,{value:"edit",children:(0,i.tZ)(s.ProfileSection.Button,{id:"password",localizationKey:t?(0,a.localizationKeys)("userProfile.start.passwordSection.primaryButton__updatePassword"):(0,a.localizationKeys)("userProfile.start.passwordSection.primaryButton__setPassword")})})]})}),(0,i.tZ)(f.a.Open,{value:"edit",children:(0,i.tZ)(f.a.Card,{children:(0,i.tZ)(et,{})})})]})})},ot=(0,s.withCardStateProvider)((()=>{const{attributes:e,instanceIsPasswordBased:t}=(0,n.useEnvironment)().userSettings,o=(0,s.useCardState)(),{user:r}=(0,p.aF)(),l=t,c=e.passkey.enabled,d=k(e).length>0,u=null==r?void 0:r.deleteSelfEnabled;return(0,i.tZ)(a.Col,{elementDescriptor:a.descriptors.page,sx:e=>({gap:e.space.$8}),children:(0,i.BX)(a.Col,{elementDescriptor:a.descriptors.profilePage,elementId:a.descriptors.profilePage.setId("security"),children:[(0,i.tZ)(s.Header.Root,{children:(0,i.tZ)(s.Header.Title,{localizationKey:(0,a.localizationKeys)("userProfile.start.headerTitle__security"),sx:e=>({marginBottom:e.space.$4}),textVariant:"h2"})}),(0,i.tZ)(s.Card.Alert,{children:o.error}),l&&(0,i.tZ)(tt,{}),c&&(0,i.tZ)(Ye,{}),d&&(0,i.tZ)($e,{}),(0,i.tZ)(he,{}),u&&(0,i.tZ)(Ze,{})]})})})),it=()=>{var e;const{pages:t}=(0,n.useUserProfileContext)(),o=t.routes[0].id===m.x.ACCOUNT,r=t.routes[0].id===m.x.SECURITY,a=null===(e=t.contents)||void 0===e?void 0:e.map(((e,t)=>{const n=!o&&!r&&0===t;return(0,i.tZ)(l.Route,{index:n,path:n?void 0:e.url,children:(0,i.tZ)(u.O,{mount:e.mount,unmount:e.unmount})},`custom-page-${e.url}`)}));return(0,i.BX)(l.Switch,{children:[a,(0,i.BX)(l.Route,{children:[(0,i.tZ)(l.Route,{path:o?void 0:"account",children:(0,i.tZ)(l.Switch,{children:(0,i.tZ)(l.Route,{index:!0,children:(0,i.tZ)(me,{})})})}),(0,i.tZ)(l.Route,{path:r?void 0:"security",children:(0,i.tZ)(l.Switch,{children:(0,i.tZ)(l.Route,{index:!0,children:(0,i.tZ)(ot,{})})})})]})]})},rt=(0,n.withCoreUserGuard)((()=>{const e=r.useRef(null);return(0,i.tZ)(s.ProfileCard.Root,{children:(0,i.BX)(d,{contentRef:e,children:[(0,i.tZ)(s.NavbarMenuButtonRow,{navbarTitleLocalizationKey:(0,a.localizationKeys)("userProfile.navbar.title")}),(0,i.tZ)(s.ProfileCard.Content,{contentRef:e,children:(0,i.tZ)(it,{})})]})})})),nt=(0,s.withCardStateProvider)((e=>(0,i.tZ)(a.Flow.Root,{flow:"userProfile",children:(0,i.tZ)(a.Flow.Part,{children:(0,i.BX)(l.Switch,{children:[(0,i.tZ)(l.Route,{path:"verify",children:(0,i.tZ)($,{})}),(0,i.tZ)(l.Route,{children:(0,i.tZ)(rt,{})})]})})}))),at=e=>{const t={...e,routing:"virtual",componentName:"UserProfile",mode:"modal"};return(0,i.tZ)(l.Route,{path:"user",children:(0,i.tZ)(n.ComponentContext.Provider,{value:t,children:(0,i.tZ)("div",{children:(0,i.tZ)(nt,{...t})})})})}}}]);