"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([[336],{3617:function(e,i,t){t.r(i),t.d(i,{OrganizationSwitcher:function(){return _}});var n=t(2903),o=t(2784),r=t(3918),a=t(3476),s=t(8512),c=t(1661),l=t(6131),d=t(2045),g=t(1940),u=t(3244),p=t(7790),h=t(3736),m=t(9820),z=t(2400),v=t(1659);const S=e=>{const i=(0,s.useCardState)(),{userSuggestions:t}=(0,l.eW)({userSuggestions:v.AO.userSuggestions});return"accepted"===e.status?(0,n.tZ)(a.Text,{colorScheme:"secondary",localizationKey:(0,a.localizationKeys)("organizationSwitcher.suggestionsAcceptedLabel")}):(0,n.tZ)(a.Button,{elementDescriptor:a.descriptors.organizationSwitcherInvitationAcceptButton,textVariant:"buttonSmall",variant:"outline",colorScheme:"neutral",size:"sm",isLoading:i.isLoading,onClick:()=>i.runAsync(e.accept).then((e=>{var i;return null===(i=null==t?void 0:t.setData)||void 0===i?void 0:i.call(t,(i=>(0,v.Sz)(e,i)))})).catch((e=>(0,z.S3)(e,[],i.setError))),localizationKey:(0,a.localizationKeys)("organizationSwitcher.action__suggestionsAccept")})},w=e=>{const i=(0,s.useCardState)();return(0,n.tZ)(a.Button,{elementDescriptor:a.descriptors.organizationSwitcherInvitationAcceptButton,textVariant:"buttonSmall",variant:"outline",colorScheme:"neutral",size:"xs",isLoading:i.isLoading,onClick:e.onAccept,localizationKey:(0,a.localizationKeys)("organizationSwitcher.action__invitationAccept")})},x=e=>{const{children:i,publicOrganizationData:t}=e;return(0,n.BX)(a.Flex,{align:"center",gap:2,sx:e=>({justifyContent:"space-between",padding:`${e.space.$4} ${e.space.$5}`}),elementDescriptor:a.descriptors.organizationSwitcherPopoverInvitationActionsBox,children:[(0,n.tZ)(s.OrganizationPreview,{elementId:"organizationSwitcherListedOrganization",organization:t,sx:e=>({color:e.colors.$colorTextSecondary,":hover":{color:e.colors.$colorTextSecondary}})}),i]})},f=(0,s.withCardStateProvider)((e=>{var i;const{invitation:t,onOrganizationClick:o}=e,{accept:c,publicOrganizationData:d,status:g}=t,u=(0,s.useCardState)(),{getOrganization:h}=(0,l.cL)(),{organization:m}=(0,l.o8)(),{userInvitations:S}=(0,l.eW)({userInvitations:v.AO.userInvitations,userMemberships:v.AO.userMemberships}),{acceptedInvitations:f,setAcceptedInvitations:P}=(0,r.useAcceptedInvitations)(),b=null===(i=f.find((e=>e.invitation.id===t.id)))||void 0===i?void 0:i.organization;return"accepted"===g?(null==b?void 0:b.id)&&(null==m?void 0:m.id)===b.id?null:(0,n.tZ)(s.PreviewButton,{elementDescriptor:a.descriptors.organizationSwitcherPreviewButton,icon:p.nR,onClick:b?()=>o(b):void 0,role:"menuitem",children:(0,n.tZ)(s.OrganizationPreview,{elementId:"organizationSwitcherListedOrganization",organization:d,sx:e=>({color:e.colors.$colorTextSecondary,":hover":{color:e.colors.$colorTextSecondary}})})}):(0,n.tZ)(x,{publicOrganizationData:d,children:(0,n.tZ)(w,{onAccept:()=>u.runAsync((async()=>[await c(),await h(d.id)])).then((([e,i])=>{var t;null===(t=null==S?void 0:S.setData)||void 0===t||t.call(S,(i=>(0,v.Sz)(e,i,"negative"))),P((t=>[...t,{organization:i,invitation:e}]))})).catch((e=>(0,z.S3)(e,[],u.setError)))})})})),P=e=>{const{showBorder:i,...t}=e;return(0,n.tZ)(s.Actions,{role:"menu",...t})},b=(0,s.withCardStateProvider)((e=>(0,n.tZ)(x,{publicOrganizationData:e.publicOrganizationData,children:(0,n.tZ)(S,{...e})}))),O=e=>{var i,t;const{onOrganizationClick:o}=e,{ref:r,userSuggestions:s,userInvitations:d}=(()=>{const{userInvitations:e,userSuggestions:i}=(0,l.eW)(v.AO),{ref:t}=(0,c.YD)({threshold:0,onChange:t=>{var n,o;t&&(e.hasNextPage?null===(n=e.fetchNext)||void 0===n||n.call(e):null===(o=i.fetchNext)||void 0===o||o.call(i))}});return{userInvitations:e,userSuggestions:i,ref:t}})(),u=d.isLoading||s.isLoading,p=d.hasNextPage||s.hasNextPage,h=(null===(i=d.data)||void 0===i?void 0:i.filter((e=>!!e)))||[],z=(null===(t=s.data)||void 0===t?void 0:t.filter((e=>!!e)))||[],S=h.length>0||z.length>0;return S||u?(0,n.tZ)(P,{showBorder:S||u,elementDescriptor:a.descriptors.organizationSwitcherPopoverInvitationActions,children:(0,n.BX)(a.Box,{sx:e=>({maxHeight:`calc(4 * ${e.sizes.$17} + 4px)`,overflowY:"auto",...m.common.unstyledScrollbar(e)}),children:[null==h?void 0:h.map((e=>(0,n.tZ)(f,{invitation:e,onOrganizationClick:o},e.id))),!d.hasNextPage&&(null==z?void 0:z.map((e=>(0,n.tZ)(b,{...e},e.id)))),(p||u)&&(0,n.tZ)(g.q7,{ref:r})]})}):null},B=e=>{const{onPersonalWorkspaceClick:i,onOrganizationClick:t}=e,{hidePersonal:o}=(0,r.useOrganizationSwitcherContext)(),{organization:d}=(0,l.o8)(),{ref:u,userMemberships:h}=(()=>{const{userMemberships:e}=(0,l.eW)({userMemberships:v.AO.userMemberships}),{ref:i}=(0,c.YD)({threshold:0,onChange:i=>{var t;i&&e.hasNextPage&&(null===(t=e.fetchNext)||void 0===t||t.call(e))}});return{userMemberships:e,ref:i}})(),{user:z}=(0,l.aF)(),S=((h.count||0)>0&&h.data||[]).map((e=>e.organization)).filter((e=>e.id!==(null==d?void 0:d.id)));if(!z)return null;const{username:w,primaryEmailAddress:x,primaryPhoneNumber:f,...P}=z,{isLoading:b,hasNextPage:O}=h;return(0,n.BX)(a.Box,{sx:e=>({maxHeight:`calc((4 * ${e.sizes.$17}) + 4px)`,overflowY:"auto","> button,div":{border:`0 solid ${e.colors.$neutralAlpha100}`},">:not([hidden])~:not([hidden])":{borderTopWidth:"1px",borderBottomWidth:"0"},...m.common.unstyledScrollbar(e)}),role:"group","aria-label":o?"List of all organization memberships":"List of all accounts",children:[d&&!o&&(0,n.tZ)(s.PreviewButton,{elementDescriptor:a.descriptors.organizationSwitcherPreviewButton,icon:p.nR,onClick:i,role:"menuitem",children:(0,n.tZ)(s.PersonalWorkspacePreview,{user:P,mainIdentifierVariant:"buttonLarge",title:(0,a.localizationKeys)("organizationSwitcher.personalWorkspace")})}),S.map((e=>(0,n.tZ)(s.PreviewButton,{elementDescriptor:a.descriptors.organizationSwitcherPreviewButton,icon:p.nR,onClick:()=>t(e),role:"menuitem",sx:e=>({border:`0 solid ${e.colors.$neutralAlpha100}`}),children:(0,n.tZ)(s.OrganizationPreview,{elementId:"organizationSwitcherListedOrganization",organization:e})},e.id))),(O||b)&&(0,n.tZ)(g.q7,{ref:u})]})},A=({onCreateOrganizationClick:e})=>{const{user:i}=(0,l.aF)();return(null==i?void 0:i.createOrganizationEnabled)?(0,n.tZ)(s.Action,{elementDescriptor:a.descriptors.organizationSwitcherPopoverActionButton,elementId:a.descriptors.organizationSwitcherPopoverActionButton.setId("createOrganization"),iconBoxElementDescriptor:a.descriptors.organizationSwitcherPopoverActionButtonIconBox,iconBoxElementId:a.descriptors.organizationSwitcherPopoverActionButtonIconBox.setId("createOrganization"),iconElementDescriptor:a.descriptors.organizationSwitcherPopoverActionButtonIcon,iconElementId:a.descriptors.organizationSwitcherPopoverActionButtonIcon.setId("createOrganization"),icon:p.mm,label:(0,a.localizationKeys)("organizationSwitcher.action__createOrganization"),onClick:e,sx:e=>({padding:`${e.space.$5} ${e.space.$5}`}),iconSx:e=>({width:e.sizes.$9,height:e.sizes.$6}),iconBoxSx:e=>({width:e.sizes.$9,height:e.sizes.$6}),spinnerSize:"sm"}):null},I=e=>{const{onCreateOrganizationClick:i,onPersonalWorkspaceClick:t,onOrganizationClick:o}=e;return(0,n.BX)(n.HY,{children:[(0,n.tZ)(O,{onOrganizationClick:o}),(0,n.tZ)(B,{onPersonalWorkspaceClick:t,onOrganizationClick:o}),(0,n.tZ)(A,{onCreateOrganizationClick:i})]})},C=o.forwardRef(((e,i)=>{const{close:t,...o}=e,c=(0,s.useCardState)(),{openOrganizationProfile:g,openCreateOrganization:m}=(0,l.cL)(),{organization:z}=(0,l.o8)(),{isLoaded:v,setActive:S}=(0,l.eW)(),w=(0,h.useRouter)(),{hidePersonal:x,__unstable_manageBillingUrl:f,__unstable_manageBillingLabel:P,__unstable_manageBillingMembersLimit:b,createOrganizationMode:O,organizationProfileMode:B,afterLeaveOrganizationUrl:A,afterCreateOrganizationUrl:C,navigateCreateOrganization:Z,navigateOrganizationProfile:k,navigateAfterSelectPersonal:y,navigateAfterSelectOrganization:_,organizationProfileProps:D,skipInvitationScreen:L}=(0,r.useOrganizationSwitcherContext)(),{user:E}=(0,l.aF)();if(!E)return null;const{username:W,primaryEmailAddress:R,primaryPhoneNumber:N,...M}=E;if(!v)return null;const T=()=>(t(),"navigation"===B?k():g({...D,afterLeaveOrganizationUrl:A,__unstable_manageBillingUrl:f,__unstable_manageBillingLabel:P,__unstable_manageBillingMembersLimit:b})),F=(0,n.tZ)(s.ExtraSmallAction,{elementDescriptor:a.descriptors.organizationSwitcherPopoverActionButton,elementId:a.descriptors.organizationSwitcherPopoverActionButton.setId("manageOrganization"),iconBoxElementDescriptor:a.descriptors.organizationSwitcherPopoverActionButtonIconBox,iconBoxElementId:a.descriptors.organizationSwitcherPopoverActionButtonIconBox.setId("manageOrganization"),iconElementDescriptor:a.descriptors.organizationSwitcherPopoverActionButtonIcon,iconElementId:a.descriptors.organizationSwitcherPopoverActionButtonIcon.setId("manageOrganization"),icon:p.tc,onClick:T,trailing:(0,n.tZ)($,{})}),K=(0,n.tZ)(s.SmallAction,{elementDescriptor:a.descriptors.organizationSwitcherPopoverActionButton,elementId:a.descriptors.organizationSwitcherPopoverActionButton.setId("manageOrganization"),iconBoxElementDescriptor:a.descriptors.organizationSwitcherPopoverActionButtonIconBox,iconBoxElementId:a.descriptors.organizationSwitcherPopoverActionButtonIconBox.setId("manageOrganization"),iconElementDescriptor:a.descriptors.organizationSwitcherPopoverActionButtonIcon,iconElementId:a.descriptors.organizationSwitcherPopoverActionButtonIcon.setId("manageOrganization"),icon:p.tc,label:(0,a.localizationKeys)("organizationSwitcher.action__manageOrganization"),onClick:T,trailing:(0,n.tZ)($,{})}),X=(0,n.tZ)(s.SmallAction,{icon:p.Nj,label:(0,d.OR)(P)||"Upgrade",onClick:()=>w.navigate((0,d.OR)(f))});return(0,n.tZ)(u.r,{elementDescriptor:a.descriptors.organizationSwitcherPopoverRootBox,children:(0,n.BX)(s.PopoverCard.Root,{elementDescriptor:a.descriptors.organizationSwitcherPopoverCard,ref:i,role:"dialog","aria-label":`${null==z?void 0:z.name} is active`,...o,children:[(0,n.tZ)(s.PopoverCard.Content,{elementDescriptor:a.descriptors.organizationSwitcherPopoverMain,children:(0,n.BX)(s.Actions,{elementDescriptor:a.descriptors.organizationSwitcherPopoverActions,role:"menu",children:[z?(e=>f?(0,n.BX)(n.HY,{children:[(0,n.tZ)(s.OrganizationPreview,{elementId:"organizationSwitcherActiveOrganization",organization:e,user:E,fetchRoles:!0,mainIdentifierVariant:"buttonLarge",sx:e=>({padding:`${e.space.$4} ${e.space.$5}`})}),(0,n.tZ)(s.Actions,{role:"menu",sx:e=>({borderBottomWidth:e.borderWidths.$normal,borderBottomStyle:e.borderStyles.$solid,borderBottomColor:e.colors.$neutralAlpha100}),children:(0,n.BX)(a.Flex,{justify:"between",sx:e=>({marginLeft:e.space.$12,padding:`0 ${e.space.$5} ${e.space.$4}`,gap:e.space.$2}),children:[K,X]})})]}):(0,n.BX)(a.Flex,{justify:"between",align:"center",sx:e=>({width:"100%",paddingRight:e.space.$5}),children:[(0,n.tZ)(s.OrganizationPreview,{elementId:"organizationSwitcherActiveOrganization",organization:e,user:E,fetchRoles:!0,mainIdentifierVariant:"buttonLarge",sx:e=>({padding:`${e.space.$4} ${e.space.$5}`})}),(0,n.tZ)(s.Actions,{role:"menu",children:F})]}))(z):!x&&(0,n.tZ)(s.PersonalWorkspacePreview,{user:M,sx:e=>({padding:`${e.space.$4} ${e.space.$5}`,width:"100%"}),title:(0,a.localizationKeys)("organizationSwitcher.personalWorkspace")}),(0,n.tZ)(I,{onCreateOrganizationClick:()=>(t(),"navigation"===O?Z():m({afterCreateOrganizationUrl:C,skipInvitationScreen:L})),onPersonalWorkspaceClick:()=>c.runAsync((()=>S({organization:null,beforeEmit:()=>y(E)}))).then(t),onOrganizationClick:e=>c.runAsync((()=>S({organization:e,beforeEmit:()=>_(e)}))).then(t)})]})}),(0,n.tZ)(s.PopoverCard.Footer,{elementDescriptor:a.descriptors.organizationSwitcherPopoverFooter})]})})})),$=(0,g.Ci)((({sx:e})=>{var i;const{organizationSettings:t}=(0,r.useEnvironment)(),o=null===(i=null==t?void 0:t.domains)||void 0===i?void 0:i.enabled,{membershipRequests:a}=(0,l.o8)({membershipRequests:o||void 0});return(null==a?void 0:a.count)?(0,n.tZ)(g.dN,{notificationCount:a.count,containerSx:e}):null}),{permission:"org:sys_memberships:manage"}),Z=(0,s.withAvatarShimmer)((0,o.forwardRef)(((e,i)=>{const{sx:t,...o}=e,{user:c}=(0,l.aF)(),{organization:d}=(0,l.o8)(),{hidePersonal:g}=(0,r.useOrganizationSwitcherContext)();if(!c)return null;const{username:u,primaryEmailAddress:h,primaryPhoneNumber:m,...z}=c;return(0,n.BX)(a.Button,{elementDescriptor:a.descriptors.organizationSwitcherTrigger,variant:"ghost",colorScheme:"neutral",hoverAsFocus:!0,focusRing:!1,sx:[e=>({padding:`${e.space.$1} ${e.space.$2}`,position:"relative"}),t],ref:i,"aria-label":(e.isOpen?"Close":"Open")+" organization switcher","aria-expanded":e.isOpen,"aria-haspopup":"dialog",...o,children:[d&&(0,n.tZ)(s.OrganizationPreview,{elementId:"organizationSwitcherTrigger",gap:3,size:"xs",fetchRoles:!0,organization:d,sx:{maxWidth:"30ch"}}),!d&&(0,n.tZ)(s.PersonalWorkspacePreview,{size:"xs",gap:3,user:z,showAvatar:!g,sx:e=>({color:e.colors.$colorTextSecondary}),title:g?(0,a.localizationKeys)("organizationSwitcher.notSelected"):(0,a.localizationKeys)("organizationSwitcher.personalWorkspace")}),(0,n.tZ)(k,{}),(0,n.tZ)(a.Icon,{elementDescriptor:a.descriptors.organizationSwitcherTriggerIcon,icon:p._M,sx:e=>({marginLeft:`${e.space.$2}`})})]})}))),k=()=>{var e;const{userInvitations:i,userSuggestions:t}=(0,l.eW)(v.AO),{organizationSettings:o}=(0,r.useEnvironment)(),a=(0,g.N2)({permission:"org:sys_memberships:manage"}),s=null===(e=null==o?void 0:o.domains)||void 0===e?void 0:e.enabled,{membershipRequests:c}=(0,l.o8)({membershipRequests:s&&a||void 0}),d=(i.count||0)+(t.count||0)+((null==c?void 0:c.count)||0);return d?(0,n.tZ)(g.dN,{containerSx:e=>({position:"absolute",top:`-${e.space.$2}`,right:`-${e.space.$2}`}),notificationCount:d}):null},y=(0,s.withFloatingTree)((()=>{const{floating:e,reference:i,styles:t,toggle:l,isOpen:d,nodeId:g,context:u}=(0,c.Sv)({placement:"bottom-start",offset:8}),p=(0,o.useId)();return(0,n.tZ)(a.Flow.Root,{flow:"organizationSwitcher",sx:{display:"inline-flex"},children:(0,n.BX)(r.AcceptedInvitationsProvider,{children:[(0,n.tZ)(Z,{ref:i,onClick:l,isOpen:d,"aria-controls":d?p:void 0,"aria-expanded":d}),(0,n.tZ)(s.Popover,{nodeId:g,context:u,isOpen:d,children:(0,n.tZ)(C,{id:p,close:l,ref:e,style:{...t}})})]})})})),_=(0,r.withCoreUserGuard)((0,s.withCardStateProvider)(y))},1659:function(e,i,t){t.d(i,{AO:function(){return n},Sz:function(){return o}});const n={userMemberships:{infinite:!0},userInvitations:{infinite:!0},userSuggestions:{infinite:!0,status:["pending","accepted"]}},o=(e,i,t)=>{var n;if(void 0===i)return[{data:[e],total_count:1}];const o=(null===(n=null==i?void 0:i[i.length-1])||void 0===n?void 0:n.total_count)||1;return i.map((i=>{if(void 0===i)return i;const n=i.data.map((i=>i.id===e.id?{...e}:i));return{...i,data:n,total_count:"negative"===t?o-1:o}}))}}}]);